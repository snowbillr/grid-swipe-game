!function(e){function t(t){for(var i,o,a=t[0],u=t[1],h=t[2],c=0,d=[];c<a.length;c++)o=a[c],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&d.push(r[o][0]),r[o]=0;for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(e[i]=u[i]);for(l&&l(t);d.length;)d.shift()();return s.push.apply(s,h||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],i=!0,a=1;a<n.length;a++){var u=n[a];0!==r[u]&&(i=!1)}i&&(s.splice(t--,1),e=o(o.s=n[0]))}return e}var i={},r={0:0},s=[];function o(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var a=window.webpackJsonp=window.webpackJsonp||[],u=a.push.bind(a);a.push=t,a=a.slice();for(var h=0;h<a.length;h++)t(a[h]);var l=u;s.push([1481,1]),n()}({1481:function(e,t,n){"use strict";n.r(t);var i,r=n(11),s=n.n(r),o=n(15),a=n.n(o),u=n(74),h=n.n(u),l=n(75),c=n.n(l),d=n(76),f=n.n(d),v=n(63),g=n.n(v),p=n(556),y=n(166),m=n.n(y);!function(e){e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT"}(i||(i={}));var b=function(){function e(t,n,i){s()(this,e),this.dungeon=t,this.x=n,this.y=i}return a()(e,[{key:"move",value:function(e){switch(e){case i.UP:this.up();break;case i.DOWN:this.down();break;case i.LEFT:this.left();break;case i.RIGHT:this.right()}return this.exists()}},{key:"up",value:function(){return this.y-=1,this.exists()}},{key:"down",value:function(){return this.y+=1,this.exists()}},{key:"left",value:function(){return this.x-=1,this.exists()}},{key:"right",value:function(){return this.x+=1,this.exists()}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this.exists()}},{key:"exists",value:function(){return this.dungeon.hasTile(this.x,this.y)}},{key:"getTile",value:function(){return this.dungeon.getTile(this.x,this.y)}}]),e}(),k=function(){function e(t,n,i,r){s()(this,e),this.dungeonTiles=t,this.markers=n,this.layers=i,this.worldWidth=void 0,this.worldHeight=void 0,this.gridWidth=void 0,this.gridHeight=void 0,this.worldWidth=r.widthInPixels,this.worldHeight=r.heightInPixels,this.gridWidth=r.width,this.gridHeight=r.height}return a()(e,[{key:"destroy",value:function(){this.dungeonTiles.forEach((function(e){return e.destroy()})),delete this.dungeonTiles,delete this.markers,this.layers.floor.destroy(),this.layers.objects.destroy(),delete this.layers}},{key:"getMarker",value:function(e){return this.markers[e]}},{key:"getCursor",value:function(e,t){return new b(this,e,t)}},{key:"hasTile",value:function(e,t){return this.dungeonTiles.some((function(n){return n.isGridPosition(e,t)}))}},{key:"getTile",value:function(e,t){var n=this.dungeonTiles.find((function(n){return n.isGridPosition(e,t)}));if(!n)throw new Error("No tile found for ".concat(e,", ").concat(t));return n}},{key:"getWalkableNeighborTile",value:function(e,t,n){var i=this.getCursor(e,t);if(i.move(n),i.exists()){var r=i.getTile();return r.isWalkable()?r:void 0}}},{key:"getDungeonLayer",value:function(e){return this.layers[e]}}]),e}(),w=function e(t,n,i,r,o){s()(this,e),this.name=t,this.gridX=n,this.gridY=i,this.worldX=r,this.worldY=o},T=function(){function e(t,n,i,r,o){s()(this,e),this.gridX=t,this.gridY=n,this.worldX=i,this.worldY=r,this.properties=o,this.enterBehaviors=void 0,this.enterBehaviors=[]}return a()(e,[{key:"destroy",value:function(){delete this.properties}},{key:"isWalkable",value:function(){return this.properties.walkable}},{key:"isObjective",value:function(){return this.properties.objective}},{key:"isGridPosition",value:function(e,t){return e===this.gridX&&t===this.gridY}},{key:"addEnterBehavior",value:function(e){this.enterBehaviors.push(e)}}]),e}(),P=function(){function e(t){s()(this,e),this.scene=t}return a()(e,[{key:"create",value:function(e,t,n,i,r){var s={walkable:r.walkable.reduce((function(e,t){return e&&t}),!0),objective:r.objective.reduce((function(e,t){return e||t}),!1)};return new T(e,t,n,i,s)}},{key:"process",value:function(e,t){}}]),e}(),x=function(){function e(t){s()(this,e),this.scene=t,this.dungeonTileFactory=void 0,this.dungeonTileFactory=new P(t)}return a()(e,[{key:"createDungeon",value:function(e,t,n){var i=this,r=this.scene.add.tilemap(e);r.addTilesetImage("dungeon-tileset","dungeon-spritesheet");var s=this.createLayers(r,t,n),o=this.createDungeonTiles(r,s),a=this.createDungeonMarkers(r,s,t,n),u=new k(o,a,s,r);return o.forEach((function(e){return i.dungeonTileFactory.process(e,u)})),u}},{key:"createLayers",value:function(e,t,n){return{floor:e.createDynamicLayer("floor","dungeon-tileset",t,n),objects:e.createDynamicLayer("objects","dungeon-tileset",t,n)}}},{key:"createDungeonTiles",value:function(e,t){var n=this,i={};return Object.values(t).forEach((function(t){t.forEachTile((function(e){var t,n="".concat(e.x,",").concat(e.y);i[n]=null!==(t=i[n])&&void 0!==t?t:{},Object.entries(e.properties).forEach((function(e){var t,r=m()(e,2),s=r[0],o=r[1];i[n][s]=null!==(t=i[n][s])&&void 0!==t?t:[],i[n][s].push(o)}))}),n,0,0,e.width,e.height,{isNotEmpty:!0})})),Object.entries(i).map((function(e){var i=m()(e,2),r=i[0],s=i[1],o=r.split(",").map(Number),a=m()(o,2),u=a[0],h=a[1],l=t.floor.tileToWorldXY(u,h);return n.dungeonTileFactory.create(u,h,l.x,l.y,s)}))}},{key:"createDungeonMarkers",value:function(e,t,n,i){return e.getObjectLayer("markers").objects.reduce((function(e,r){var s=t.floor.getTileAtWorldXY(r.x+n,r.y+i),o=t.floor.tileToWorldXY(s.x,s.y);return e[r.name]=new w(r.name,s.x,s.y,o.x,o.y),e}),{})}}]),e}(),O=function(){function e(t,n){var i,r;s()(this,e),this.scene=void 0,this.x=void 0,this.y=void 0,this.texture=void 0,this.depth=void 0,this.originX=void 0,this.originY=void 0,this.sprite=void 0,this.scene=t,this.x=n.x,this.y=n.y,this.texture=n.texture,this.depth=n.depth,this.originX=null!==(i=n.originX)&&void 0!==i?i:.5,this.originY=null!==(r=n.originY)&&void 0!==r?r:.5}return a()(e,[{key:"onAdd",value:function(){this.sprite=this.scene.add.sprite(this.x,this.y,this.texture),this.sprite.setDepth(this.depth),this.sprite.setOrigin(this.originX,this.originY)}},{key:"destroy",value:function(){}}]),e}(),E=function(){function e(t,n){s()(this,e),this.gridX=void 0,this.gridY=void 0,this.gridX=n.gridX,this.gridY=n.gridY}return a()(e,[{key:"setGridPosition",value:function(e,t){this.gridX=e,this.gridY=t}},{key:"destroy",value:function(){}}]),e}(),D=n(557),N=function(){function e(t,n,i){s()(this,e),this.scene=void 0,this.data=void 0,this.entity=void 0,this.stateMachine=void 0,this.scene=t,this.data=n,this.entity=i}return a()(e,[{key:"onAdd",value:function(){var e=this;this.stateMachine=new D.a(this.scene,this.entity,this.data.states,this.data.initialState),this.stateMachine.start(),this.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,(function(){return e.updateStateMachine}))}},{key:"destroy",value:function(){var e=this;this.scene.events.off(Phaser.Scenes.Events.POST_UPDATE,(function(){return e.updateStateMachine}))}},{key:"updateStateMachine",value:function(){this.stateMachine.update()}}]),e}(),W=[{id:"idle",transitions:[],onEnter:function(e){e.getComponent(O).sprite.anims.play("hero-idle")}},{id:"moving",transitions:[],onEnter:function(e){e.getComponent(O).sprite.anims.play("hero-run")}}],I={components:[{component:O,data:{texture:"hero",depth:50,originX:0,originY:.5}},E,{component:N,data:{states:W,initialState:W[0]}}]},S=function(e,t,n,r){for(var s=!0,o=e.getComponent(O).sprite,a=e.getComponent(E),u=new Phaser.Math.Vector2(a.gridX,a.gridY),h=r.tweens.timeline({tweens:[{targets:[],duration:0}],paused:!0,onStart:function(){e.getComponent(N).stateMachine.doTransition({to:"moving",onTransition:function(e){var n=e.getComponent(O).sprite;t===i.LEFT?n.flipX=!0:t===i.RIGHT&&(n.flipX=!1)}})},onComplete:function(){e.getComponent(N).stateMachine.doTransition({to:"idle"})}}),l=function(){var e=n.getWalkableNeighborTile(u.x,u.y,t);if(e){var i=new Phaser.Math.Vector2(e.worldX,e.worldY);h.add({targets:o,props:{x:i.x,y:i.y},duration:200,onComplete:function(){a.setGridPosition(e.gridX,e.gridY),e.enterBehaviors.forEach((function(e){return e()}))}}),u.set(e.gridX,e.gridY)}else s=!1};s;)l();return h},X=352,M=600,Y=function(e){function t(){var e;return s()(this,t),(e=h()(this,c()(t).call(this,{key:"dungeon"}))).phecs=void 0,e.levelManager=void 0,e.dungeon=void 0,e.hero=void 0,e.controls=void 0,e.levelNumber=void 0,e}return f()(t,e),a()(t,[{key:"init",value:function(){var e=this;this.phecs.register.prefab("hero",I),this.events.on(Phaser.Scenes.Events.SHUTDOWN,(function(){return e.destroy()}))}},{key:"create",value:function(e){var t=this;this.levelNumber=e.levelNumber;var n=new x(this);this.dungeon=n.createDungeon(this.levelManager.getLevelKey(this.levelNumber),0,0);var r=this.dungeon.getMarker("hero-start");this.hero=this.phecs.add.prefab("hero",{gridX:r.gridX,gridY:r.gridY},r.worldX,r.worldY),this.controls=this.input.keyboard.addKeys({up:Phaser.Input.Keyboard.KeyCodes.UP,down:Phaser.Input.Keyboard.KeyCodes.DOWN,left:Phaser.Input.Keyboard.KeyCodes.LEFT,right:Phaser.Input.Keyboard.KeyCodes.RIGHT}),this.controls.up.on(Phaser.Input.Keyboard.Events.DOWN,(function(){return t.handleInput(i.UP)})),this.controls.down.on(Phaser.Input.Keyboard.Events.DOWN,(function(){return t.handleInput(i.DOWN)})),this.controls.left.on(Phaser.Input.Keyboard.Events.DOWN,(function(){return t.handleInput(i.LEFT)})),this.controls.right.on(Phaser.Input.Keyboard.Events.DOWN,(function(){return t.handleInput(i.RIGHT)}));var s=this.calculateCameraBounds(),o=s.x,a=s.y,u=s.width,h=s.height;this.cameras.main.setBounds(o,a,u,h),this.cameras.main.setBackgroundColor(2429722),this.cameras.main.startFollow(this.hero.getComponent(O).sprite),this.cameras.main.fadeIn(500)}},{key:"destroy",value:function(){this.controls.up.off(Phaser.Input.Keyboard.Events.DOWN),this.controls.down.off(Phaser.Input.Keyboard.Events.DOWN),this.controls.left.off(Phaser.Input.Keyboard.Events.DOWN),this.controls.right.off(Phaser.Input.Keyboard.Events.DOWN)}},{key:"handleInput",value:function(e){var t=this;if("moving"!==this.hero.getComponent(N).stateMachine.currentState.id){var n=this.hero.getComponent(E),i=this.dungeon.getCursor(n.gridX,n.gridY);if(i.move(e),i.getTile().isWalkable())S(this.hero,e,this.dungeon,this).play();else i.getTile().isObjective()&&(this.levelManager.hasLevel(this.levelNumber+1)?(this.cameras.main.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,(function(){t.scene.restart({levelNumber:t.levelNumber+1})})),this.cameras.main.fadeOut(500)):console.log("beat all the levels"))}}},{key:"calculateCameraBounds",value:function(){var e=0,t=0,n=this.dungeon.worldWidth,i=this.dungeon.worldHeight;return n<X&&(e-=(X-n)/2),i<M&&(t-=(M-i)/2),{x:e,y:t,width:n,height:i}}}]),t}(Phaser.Scene),j=Array.from({length:3},(function(e,t){return t+1})).reduce((function(e,t){var n=String(t).padStart(3,"0");return e[t]="level-".concat(n),e}),{}),C=function(e){function t(e){return s()(this,t),h()(this,c()(t).call(this,e))}return f()(t,e),a()(t,[{key:"hasLevel",value:function(e){return Boolean(j[e])}},{key:"getLevelKey",value:function(e){return j[e]}}]),t}(Phaser.Plugins.BasePlugin),K=function(e){function t(){return s()(this,t),h()(this,c()(t).call(this,{key:"preload"}))}return f()(t,e),a()(t,[{key:"preload",value:function(){this.load.image("dungeon-spritesheet","assets/maps/dungeon-spritesheet.png");for(var e=1;e<=3;e++){var t=String(e).padStart(3,"0");this.load.tilemapTiledJSON("level-".concat(t),"assets/levels/".concat(t,".json"))}this.load.spritesheet("hero","assets/characters/hero/spritesheet.png",{frameWidth:32,frameHeight:56}),this.load.animation("hero-animations","assets/characters/hero/animations.json")}},{key:"create",value:function(){this.scene.start("dungeon",{levelNumber:1})}}]),t}(Phaser.Scene);g.a.Scene,new g.a.Game({width:X,height:M,scene:[K,Y],plugins:{scene:[{key:"Phecs",plugin:p.a,mapping:"phecs"}],global:[{key:"LeveLManagerPlugin",plugin:C,mapping:"levelManager",start:!0}]}})}});