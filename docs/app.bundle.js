!function(e){function t(t){for(var n,o,a=t[0],u=t[1],c=t[2],l=0,d=[];l<a.length;l++)o=a[l],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&d.push(s[o][0]),s[o]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);for(h&&h(t);d.length;)d.shift()();return r.push.apply(r,c||[]),i()}function i(){for(var e,t=0;t<r.length;t++){for(var i=r[t],n=!0,a=1;a<i.length;a++){var u=i[a];0!==s[u]&&(n=!1)}n&&(r.splice(t--,1),e=o(o.s=i[0]))}return e}var n={},s={0:0},r=[];function o(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=n,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var a=window.webpackJsonp=window.webpackJsonp||[],u=a.push.bind(a);a.push=t,a=a.slice();for(var c=0;c<a.length;c++)t(a[c]);var h=u;r.push([1482,1]),i()}({1482:function(e,t,i){"use strict";i.r(t);var n,s=i(3),r=i.n(s),o=i(4),a=i.n(o),u=i(19),c=i.n(u),h=i(20),l=i.n(h),d=i(21),v=i.n(d),f=i(45),g=i.n(f),p=i(558),m=i(68),y=i.n(m);!function(e){e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT"}(n||(n={}));var b,k=function(){function e(t,i,n){r()(this,e),this.dungeon=t,this.x=i,this.y=n,this.initialX=void 0,this.initialY=void 0,this.initialX=i,this.initialY=n}return a()(e,[{key:"move",value:function(e){switch(e){case n.UP:this.up();break;case n.DOWN:this.down();break;case n.LEFT:this.left();break;case n.RIGHT:this.right()}return this.exists()}},{key:"up",value:function(){return this.y-=1,this.exists()}},{key:"down",value:function(){return this.y+=1,this.exists()}},{key:"left",value:function(){return this.x-=1,this.exists()}},{key:"right",value:function(){return this.x+=1,this.exists()}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this.exists()}},{key:"reset",value:function(){this.x=this.initialX,this.y=this.initialY}},{key:"exists",value:function(){return this.dungeon.hasTile(this.x,this.y)}},{key:"getTile",value:function(){return this.dungeon.getTile(this.x,this.y)}},{key:"getCardinalNeighbors",value:function(){var e=[];return this.up()&&e.push({direction:n.UP,dungeonTile:this.getTile()}),this.down(),this.down()&&e.push({direction:n.DOWN,dungeonTile:this.getTile()}),this.up(),this.left()&&e.push({direction:n.LEFT,dungeonTile:this.getTile()}),this.right(),this.right()&&e.push({direction:n.RIGHT,dungeonTile:this.getTile()}),this.left(),e}}]),e}(),T=function(){function e(){r()(this,e),this.coins=void 0,this.moves=void 0,this.coins=0,this.moves=0}return a()(e,[{key:"reset",value:function(){this.coins=0,this.moves=0}},{key:"incrementCoins",value:function(){this.coins+=1}},{key:"getCoins",value:function(){return this.coins}},{key:"incrementMoves",value:function(){this.moves+=1}},{key:"getMoves",value:function(){return this.moves}}]),e}(),x=function(){function e(t,i,n,s){r()(this,e),this.dungeonTiles=t,this.markers=i,this.floor=n,this.worldWidth=void 0,this.worldHeight=void 0,this.gridWidth=void 0,this.gridHeight=void 0,this.stats=void 0,this.coinCount=void 0,this.worldWidth=s.widthInPixels,this.worldHeight=s.heightInPixels,this.gridWidth=s.width,this.gridHeight=s.height,this.coinCount=t.reduce((function(e,t){return Boolean(t.getObject("coin"))?e+1:e}),0),this.stats=new T}return a()(e,[{key:"destroy",value:function(){this.dungeonTiles.forEach((function(e){return e.destroy()})),delete this.dungeonTiles,delete this.markers,this.floor.destroy(),delete this.floor}},{key:"getMarker",value:function(e){return this.markers[e]}},{key:"getCursor",value:function(e,t){return new k(this,e,t)}},{key:"hasTile",value:function(e,t){return this.dungeonTiles.some((function(i){return i.isGridPosition(e,t)}))}},{key:"getTile",value:function(e,t){var i=this.dungeonTiles.find((function(i){return i.isGridPosition(e,t)}));if(!i)throw new Error("No tile found for ".concat(e,", ").concat(t));return i}},{key:"getWalkableNeighborTile",value:function(e,t,i){var n=this.getCursor(e,t);if(n.move(i),n.exists()){var s=n.getTile();return s.isWalkable()?s:void 0}}}]),e}(),P=function e(t,i,n,s,o){r()(this,e),this.name=t,this.gridX=i,this.gridY=n,this.worldX=s,this.worldY=o},w=i(32),E=i.n(w);!function(e){e.INPUT="INPUT",e.ENTER="ENTER",e.EXIT="EXIT"}(b||(b={}));var O=function(){function e(t,i,n,s,o,a){var u;r()(this,e),this.gridX=t,this.gridY=i,this.worldX=n,this.worldY=s,this.properties=o,this.objects=a,this.behaviors=void 0,this.behaviors=(u={},E()(u,b.INPUT,[]),E()(u,b.ENTER,[]),E()(u,b.EXIT,[]),u)}return a()(e,[{key:"destroy",value:function(){delete this.properties,this.objects.forEach((function(e){return e.destroy()})),this.behaviors[b.INPUT]=[],this.behaviors[b.ENTER]=[],this.behaviors[b.EXIT]=[]}},{key:"isWalkable",value:function(){return this.properties.walkable}},{key:"isObjective",value:function(){return this.properties.objective}},{key:"isGridPosition",value:function(e,t){return e===this.gridX&&t===this.gridY}},{key:"getObject",value:function(e){return this.objects.find((function(t){return t.name===e}))}},{key:"addObject",value:function(e){this.objects.push(e)}},{key:"removeObject",value:function(e){var t=this.objects.findIndex((function(t){return t.name===e})),i=this.objects.splice(t,1);y()(i,1)[0].destroy()}},{key:"addBehavior",value:function(e,t){this.behaviors[e].push(t)}},{key:"removeBehavior",value:function(e,t){var i=this.behaviors[e],n=i.findIndex((function(e){return e==t}));i.splice(n,1)}},{key:"runBehaviors",value:function(e,t,i){var n=this.behaviors[e].slice().sort((function(e,t){return t.priority-e.priority})),s=!0,r=!1,o=void 0;try{for(var a,u=n[Symbol.iterator]();!(s=(a=u.next()).done);s=!0){if(a.value.run(t,this,i))break}}catch(e){r=!0,o=e}finally{try{s||null==u.return||u.return()}finally{if(r)throw o}}}}]),e}(),C=function(){function e(t,i){var n,s;r()(this,e),this.scene=void 0,this.x=void 0,this.y=void 0,this.texture=void 0,this.depth=void 0,this.originX=void 0,this.originY=void 0,this.sprite=void 0,this.scene=t,this.x=i.x,this.y=i.y,this.texture=i.texture,this.depth=i.depth,this.originX=null!==(n=i.originX)&&void 0!==n?n:.5,this.originY=null!==(s=i.originY)&&void 0!==s?s:.5}return a()(e,[{key:"onAdd",value:function(){this.sprite=this.scene.add.sprite(this.x,this.y,this.texture),this.sprite.setDepth(this.depth),this.sprite.setOrigin(this.originX,this.originY)}},{key:"destroy",value:function(){}}]),e}(),I=function(){function e(t,i){r()(this,e),this.gridX=void 0,this.gridY=void 0,this.gridX=i.gridX,this.gridY=i.gridY}return a()(e,[{key:"setGridPosition",value:function(e,t){this.gridX=e,this.gridY=t}},{key:"destroy",value:function(){}}]),e}(),N=i(559),j=function(){function e(t,i,n){r()(this,e),this.scene=void 0,this.data=void 0,this.entity=void 0,this.stateMachine=void 0,this.scene=t,this.data=i,this.entity=n}return a()(e,[{key:"onAdd",value:function(){var e=this;this.stateMachine=new N.a(this.scene,this.entity,this.data.states,this.data.initialState),this.stateMachine.start(),this.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,(function(){return e.updateStateMachine}))}},{key:"destroy",value:function(){var e=this;this.scene.events.off(Phaser.Scenes.Events.POST_UPDATE,(function(){return e.updateStateMachine}))}},{key:"updateStateMachine",value:function(){this.stateMachine.update()}}]),e}(),L=function(){function e(){r()(this,e),this.callbacks=void 0,this.currentIndex=void 0,this.callbacks=[],this.currentIndex=0}return a()(e,[{key:"addCallback",value:function(e){this.callbacks.push({callback:e,hasRun:!1})}},{key:"runNext",value:function(){this.callbacks[this.currentIndex].callback(),this.callbacks[this.currentIndex].hasRun=!0,this.currentIndex+=1}}]),e}(),M=function(e,t,i,s){var r=e.getComponent(C).sprite,o=e.getComponent(I),a=new Phaser.Math.Vector2(o.gridX,o.gridY),u=i.getCursor(a.x,a.y).move(t),c=new L,h=s.tweens.timeline({tweens:[{targets:[],duration:0}],paused:!0,onStart:function(){c.runNext()},onComplete:function(){c.runNext()}});c.addCallback((function(){e.getComponent(j).stateMachine.doTransition({to:"moving",onTransition:function(e){var i=e.getComponent(C).sprite;t===n.LEFT?i.flipX=!0:t===n.RIGHT&&(i.flipX=!1)}})}));for(var l=function(){var e=i.getTile(a.x,a.y),n=i.getWalkableNeighborTile(a.x,a.y,t);if(n){var l=new Phaser.Math.Vector2(n.worldX,n.worldY);h.add({targets:r,props:{x:l.x,y:l.y},duration:200,onStart:function(){c.runNext()},onComplete:function(){c.runNext()}}),c.addCallback((function(){e.runBehaviors(b.EXIT,t,s)})),c.addCallback((function(){o.setGridPosition(n.gridX,n.gridY),n.runBehaviors(b.ENTER,t,s)})),a.set(n.gridX,n.gridY)}else u=!1};u;)l();return c.addCallback((function(){e.getComponent(j).stateMachine.doTransition({to:"idle"})})),h},S=[{priority:90,isApplicable:function(e,t){return e.isWalkable()},run:function(e,t,i){i.dungeon.stats.incrementMoves(),M(i.hero,e,i.dungeon,i).play()}},{priority:100,isApplicable:function(e,t){return t.getCursor(e.gridX,e.gridY).getCardinalNeighbors().some((function(e){return e.dungeonTile.isObjective()}))},run:function(e,t,i){var n,s=i.dungeon.getCursor(t.gridX,t.gridY);if(s.move(e),!s.getTile().isObjective())return!1;t.removeObject("swipe-indicator");var r=null===(n=s.getTile().getObject("objective"))||void 0===n?void 0:n.sprite,o=new Promise((function(e){null==r||r.once(Phaser.Animations.Events.SPRITE_ANIMATION_COMPLETE,e)}));return i.sfx.pauseLevelMusic(),null==r||r.anims.play("objective-win"),Promise.all([o,i.sfx.playWinSfx()]).then((function(){i.levelManager.hasNextLevel()?(i.cameras.main.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,(function(){i.persistence.getDocument("progress").completeLevel(i.levelManager.getCurrentLevelNumber(),i.dungeon.stats),i.persistence.store(),i.levelManager.setCurrentLevelNumber(i.levelManager.getCurrentLevelNumber()+1),i.scene.restart()})),i.cameras.main.fadeOut(700)):console.log("beat all the levels")})),!0}}],D={priority:100,isApplicable:function(e,t){return Boolean(e.getObject("coin"))},run:function(e,t,i){var n,s=null===(n=t.getObject("coin"))||void 0===n?void 0:n.sprite;i.sfx.playCoinSfx(),i.dungeon.stats.incrementCoins(),i.hud.setCollectedCoins(i.dungeon.stats.getCoins()),i.tweens.add({targets:s,props:{y:"-=50",alpha:0},duration:200}),t.removeBehavior(b.ENTER,this)}},X=function(){function e(t,i){r()(this,e),this.name=t,this.sprite=i}return a()(e,[{key:"destroy",value:function(){this.sprite.destroy()}}]),e}(),R=50,W=[{name:"rock",tileIndex:50,texture:"rock",depth:40},{name:"objective",tileIndex:85,texture:"objective",frame:0,depth:40},{name:"coin",tileIndex:87,texture:"coin",frame:0,animation:"coin-spin",depth:60},{name:"swipe-indicator",texture:"swipe-indicator",frame:0,animation:"swipe-indicator-bounce",depth:60}],Y=function(){function e(t){r()(this,e),this.scene=t}return a()(e,[{key:"createByIndex",value:function(e,t,i){var n=Object.values(W).find((function(e){return e.tileIndex===i}));if(!n)throw new Error("DungeonObjectFactory: missing properties for ".concat(i));return this.create(e,t,n)}},{key:"createByName",value:function(e,t,i){var n=Object.values(W).find((function(e){return e.name===i}));if(!n)throw new Error("DungeonObjectFactory: missing properties for ".concat(i));return this.create(e,t,n)}},{key:"create",value:function(e,t,i){var n=i.texture,s=i.frame,r=i.depth,o=this.scene.add.sprite(e,t,n,s).setOrigin(0).setDepth(r),a=i.name,u=i.animation;return u&&o.anims.play(u),new X(a,o)}}]),e}(),H=[D,{priority:100,isApplicable:function(e,t){return t.getCursor(e.gridX,e.gridY).getCardinalNeighbors().some((function(e){return e.dungeonTile.isObjective()}))},run:function(e,t,i){var s,r,o,a;if(i.dungeon.getCursor(t.gridX,t.gridY).getCardinalNeighbors().forEach((function(e){var t=e.dungeonTile,i=e.direction;t.isObjective()&&(a=i)})),!a)throw new Error("EnterBehavior - ShowSwipeIndicator - no objective neighbor found");var u=(s={},E()(s,n.DOWN,0),E()(s,n.LEFT,Math.PI/2),E()(s,n.UP,Math.PI),E()(s,n.RIGHT,Math.PI+Math.PI/2),s)[a],c=(r={},E()(r,n.DOWN,16),E()(r,n.LEFT,0),E()(r,n.UP,16),E()(r,n.RIGHT,32),r)[a],h=(o={},E()(o,n.DOWN,32),E()(o,n.LEFT,16),E()(o,n.UP,0),E()(o,n.RIGHT,16),o)[a],l=new Y(i).createByName(t.worldX,t.worldY,"swipe-indicator");l.sprite.setPosition(t.worldX+c,t.worldY+h).setOrigin(.5).setRotation(u),t.addObject(l)}}],B=[{priority:100,isApplicable:function(e,t){return t.getCursor(e.gridX,e.gridY).getCardinalNeighbors().some((function(e){return e.dungeonTile.isObjective()}))},run:function(e,t,i){t.removeObject("swipe-indicator")}}],F=function(){function e(){r()(this,e)}return a()(e,[{key:"create",value:function(e,t,i,n,s){var r={walkable:s.walkable.reduce((function(e,t){return e&&t}),!0),objective:s.objective.reduce((function(e,t){return e||t}),!1)};return new O(e,t,i,n,r,s.objects||[])}},{key:"addBehaviors",value:function(e,t){S.forEach((function(i){i.isApplicable(e,t)&&e.addBehavior(b.INPUT,i)})),H.forEach((function(i){i.isApplicable(e,t)&&e.addBehavior(b.ENTER,i)})),B.forEach((function(i){i.isApplicable(e,t)&&e.addBehavior(b.EXIT,i)}))}}]),e}(),U=function(){function e(t){r()(this,e),this.scene=t,this.dungeonTileFactory=void 0,this.dungeonObjectFactory=void 0,this.dungeonTileFactory=new F,this.dungeonObjectFactory=new Y(t)}return a()(e,[{key:"createDungeon",value:function(e,t,i){var n=this,s=this.scene.add.tilemap(e);s.addTilesetImage("dungeon-tileset","dungeon-spritesheet");var r=this.createFloor(s,t,i);s.setLayer("floor");var o=this.createDungeonTiles(s,r),a=this.createDungeonMarkers(s,t,i),u=new x(o,a,r,s);return o.forEach((function(e){return n.dungeonTileFactory.addBehaviors(e,u)})),u}},{key:"createFloor",value:function(e,t,i){return e.createDynamicLayer("floor","dungeon-tileset",t,i)}},{key:"createDungeonTiles",value:function(e,t){var i=this,n=new A;t.forEachTile((function(e){Object.entries(e.properties).forEach((function(t){var i=y()(t,2),s=i[0],r=i[1];n.addKeyValue(e.x,e.y,s,r)}))}),this,0,0,e.width,e.height,{isNotEmpty:!0}),e.getLayer("objects").data.flat().filter((function(e){return-1!==e.index})).forEach((function(t){var s=e.tileToWorldXY(t.x,t.y),r=i.dungeonObjectFactory.createByIndex(s.x,s.y,t.index);n.addKeyValue(t.x,t.y,"objects",r),Object.entries(t.properties).forEach((function(e){var i=y()(e,2),s=i[0],r=i[1];n.addKeyValue(t.x,t.y,s,r)}))}));var s=[];return n.forEach((function(t,n){var r=e.tileToWorldXY(t.x,t.y),o=i.dungeonTileFactory.create(t.x,t.y,r.x,r.y,n);s.push(o)})),s}},{key:"createDungeonMarkers",value:function(e,t,i){return e.getObjectLayer("markers").objects.reduce((function(n,s){var r=e.getTileAtWorldXY(s.x+t,s.y+i),o=e.tileToWorldXY(r.x,r.y);return n[s.name]=new P(s.name,r.x,r.y,o.x,o.y),n}),{})}}]),e}(),A=function(){function e(){r()(this,e),this.tileData=void 0,this.tileData={}}return a()(e,[{key:"addKeyValue",value:function(e,t,i,n){var s,r,o=this.coordinatesToTileKey(e,t);this.tileData[o]=null!==(s=this.tileData[o])&&void 0!==s?s:{},this.tileData[o][i]=null!==(r=this.tileData[o][i])&&void 0!==r?r:[],this.tileData[o][i].push(n)}},{key:"forEach",value:function(e){var t=this;Object.entries(this.tileData).forEach((function(i){var n=y()(i,2),s=n[0],r=n[1],o=t.tileKeyToCoordinates(s);e(o,r)}))}},{key:"coordinatesToTileKey",value:function(e,t){return"".concat(e,",").concat(t)}},{key:"tileKeyToCoordinates",value:function(e){var t=e.split(",").map(Number),i=y()(t,2);return{x:i[0],y:i[1]}}}]),e}(),_=[{id:"idle",transitions:[],onEnter:function(e){e.getComponent(C).sprite.anims.play("hero-idle")}},{id:"moving",transitions:[],onEnter:function(e){e.getComponent(C).sprite.anims.play("hero-run")}}],G={components:[{component:C,data:{texture:"hero",depth:R,originX:0,originY:.5}},I,{component:j,data:{states:_,initialState:_[0]}}]},K={WIDTH:342,HEIGHT:608},J=function(e){function t(){var e,i;r()(this,t);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(i=c()(this,(e=l()(t)).call.apply(e,[this].concat(s)))).persistence=void 0,i.phecs=void 0,i.levelManager=void 0,i.swipe=void 0,i}return v()(t,e),a()(t,[{key:"sfx",get:function(){return this.scene.get("music")}}]),t}(Phaser.Scene),V=function(e){function t(){var e;return r()(this,t),(e=c()(this,l()(t).call(this,{key:"dungeon"}))).dungeon=void 0,e.hero=void 0,e.hud=void 0,e}return v()(t,e),a()(t,[{key:"init",value:function(){this.phecs.register.prefab("hero",G)}},{key:"create",value:function(){var e=this,t=new U(this);this.dungeon=t.createDungeon(this.levelManager.getCurrentLevelKey(),0,0);var i=this.dungeon.getMarker("hero-start");this.hero=this.phecs.add.prefab("hero",{gridX:i.gridX,gridY:i.gridY},i.worldX,i.worldY),this.swipe.addListener((function(t){e.handleInput(t)}));var n=this.calculateCameraBounds(),s=n.x,r=n.y,o=n.width,a=n.height;this.cameras.main.setBounds(s,r,o,a),this.cameras.main.setBackgroundColor(2429722),this.cameras.main.startFollow(this.hero.getComponent(C).sprite),this.cameras.main.fadeIn(500),this.sfx.playLevelMusic(),this.scene.launch("hud",{totalCoins:this.dungeon.coinCount}),this.hud=this.scene.get("hud")}},{key:"resetLevel",value:function(){var e=this;this.dungeon.stats.reset(),this.sfx.pauseLevelMusic(),this.sfx.playResetSfx(),this.cameras.main.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,(function(){e.scene.stop(),e.scene.restart()})),this.cameras.main.fadeOut(1e3)}},{key:"handleInput",value:function(e){if("moving"!==this.hero.getComponent(j).stateMachine.currentState.id){var t=this.hero.getComponent(I);this.dungeon.getCursor(t.gridX,t.gridY).getTile().runBehaviors(b.INPUT,e,this)}}},{key:"calculateCameraBounds",value:function(){var e=0,t=0,i=this.dungeon.worldWidth,n=this.dungeon.worldHeight;return i<K.WIDTH&&(e-=(K.WIDTH-i)/2),n<K.HEIGHT&&(t-=(K.HEIGHT-n)/2),{x:e,y:t,width:i,height:n}}}]),t}(J),Q=Array.from({length:4},(function(e,t){return t+1})).reduce((function(e,t){var i=String(t).padStart(3,"0");return e[t]="level-".concat(i),e}),{}),z=function(e){function t(e){var i;return r()(this,t),(i=c()(this,l()(t).call(this,e))).currentLevelNumber=void 0,i.currentLevelNumber=0,i}return v()(t,e),a()(t,[{key:"setCurrentLevelNumber",value:function(e){this.currentLevelNumber=e}},{key:"getCurrentLevelNumber",value:function(){return this.currentLevelNumber}},{key:"hasNextLevel",value:function(){return this.hasLevel(this.currentLevelNumber+1)}},{key:"hasLevel",value:function(e){return Boolean(Q[null!=e?e:this.currentLevelNumber])}},{key:"getCurrentLevelKey",value:function(){return Q[this.currentLevelNumber]}}]),t}(Phaser.Plugins.BasePlugin),Z=function(e){function t(){return r()(this,t),c()(this,l()(t).call(this,{key:"preload"}))}return v()(t,e),a()(t,[{key:"preload",value:function(){this.cameras.main.setBackgroundColor(4007227);var e=K.WIDTH/2,t=K.HEIGHT/2,i=(this.add.rectangle(e-75,t,150,40,14306872).setOrigin(0,.5),this.add.rectangle(e-75+3,t,0,34,15633710).setOrigin(0,.5));this.load.on(Phaser.Loader.Events.PROGRESS,(function(e){var t=144*e;i.width=t})),this.load.audio("coin",["assets/sfx/coin.mp3","assets/sfx/coin.ogg"]),this.load.audio("die",["assets/sfx/die.mp3","assets/sfx/die.ogg"]),this.load.audio("level-complete",["assets/sfx/level-complete.mp3","assets/sfx/level-complete.ogg"]),this.load.audio("level-reset",["assets/sfx/level-reset.mp3","assets/sfx/level-reset.ogg"]),this.load.audio("level-music",["assets/music/level-music.mp3","assets/music/level-music.ogg"]),this.load.audio("level-complete-music",["assets/music/level-complete-music.mp3","assets/music/level-complete-music.ogg"]),this.load.image("logo","assets/logo/scooch-dungeon-logo.png"),this.load.bitmapFont("matchup-64","assets/fonts/matchup-64.png","assets/fonts/matchup-64.xml"),this.load.bitmapFont("matchup-32","assets/fonts/matchup-32.png","assets/fonts/matchup-32.xml"),this.load.image("hud-restart","assets/images/hud-restart.png"),this.load.spritesheet("swipe-indicator","assets/interface/swipe-indicator.png",{frameWidth:32,frameHeight:32}),this.load.animation("swipe-indicator-animations","assets/interface/swipe-indicator-animations.json"),this.load.image("dungeon-spritesheet","assets/maps/dungeon-spritesheet.png"),this.load.spritesheet("objective","assets/objects/objective.png",{frameWidth:32,frameHeight:32}),this.load.animation("objective-animations","assets/objects/objective-animations.json"),this.load.spritesheet("coin","assets/objects/coin.png",{frameWidth:32,frameHeight:32}),this.load.animation("coin-animations","assets/objects/coin-animations.json"),this.load.image("rock","assets/objects/rock.png");for(var n=1;n<=4;n++){var s=String(n).padStart(3,"0");this.load.tilemapTiledJSON("level-".concat(s),"assets/levels/".concat(s,".json"))}this.load.spritesheet("hero","assets/characters/hero/spritesheet.png",{frameWidth:32,frameHeight:56}),this.load.animation("hero-animations","assets/characters/hero/animations.json")}},{key:"create",value:function(){this.persistence.read(),this.scene.start("title")}}]),t}(J),q=function(e){function t(){return r()(this,t),c()(this,l()(t).call(this,{key:"title"}))}return v()(t,e),a()(t,[{key:"create",value:function(){var e=this;this.cameras.main.setBackgroundColor(4007227);var t=this.add.image(-300,100,"logo").setScale(.6),i=0===this.persistence.getDocument("progress").getLastCompletedLevelNumber()?"PLAY":"CONTINUE",n=this.addButton(this.cameras.main.centerX,K.HEIGHT+100,i,(function(){var t=e.persistence.getDocument("progress");e.levelManager.setCurrentLevelNumber(t.getLastCompletedLevelNumber()+1),e.scene.launch("music"),e.scene.start("dungeon")}));this.tweens.timeline({tweens:[{targets:t,props:{x:this.cameras.main.centerX},ease:Phaser.Math.Easing.Quadratic.Out,duration:750},{targets:n,props:{y:300},offset:300,ease:Phaser.Math.Easing.Quadratic.Out,duration:550}]})}},{key:"addButton",value:function(e,t,i,n){var s=this.add.container(e,t).setSize(240,80).setInteractive().on(Phaser.Input.Events.POINTER_DOWN,n),r=this.add.rectangle(0,0,240,80,14306872).setOrigin(.5),o=this.add.rectangle(0,0,230,70,15633710).setOrigin(.5),a=this.add.bitmapText(0,-5,"matchup-64",i).setOrigin(.5);return s.add(r),s.add(o),s.add(a),s}}]),t}(J),$=function(e){function t(e){var i;return r()(this,t),(i=c()(this,l()(t).call(this,e))).documents=void 0,i.documents=[],i}return v()(t,e),a()(t,[{key:"addDocument",value:function(e){this.documents.push(e)}},{key:"getDocument",value:function(e){var t=this.documents.find((function(t){return t.name===e}));if(!t)throw new Error("No persistence document found: ".concat(e));return t}},{key:"store",value:function(){var e=this.documents.reduce((function(e,t){return e[t.name]=t.toJson(),e}),{});window.localStorage.setItem("scooch-dungeon",JSON.stringify(e))}},{key:"read",value:function(){var e=this,t=window.localStorage.getItem("scooch-dungeon")||"{}",i=JSON.parse(t);Object.entries(i).forEach((function(t){var i=y()(t,2),n=i[0],s=i[1],r=e.documents.find((function(e){return e.name===n}));null==r||r.fromJson(s)}))}}]),t}(Phaser.Plugins.BasePlugin),ee=function(){function e(){r()(this,e),this.name="progress",this.levelRecords={}}return a()(e,[{key:"toJson",value:function(){return{levelRecords:this.levelRecords}}},{key:"fromJson",value:function(e){this.levelRecords=e.levelRecords}},{key:"completeLevel",value:function(e,t){var i,n=null!==(i=this.levelRecords[e])&&void 0!==i?i:{levelNumber:e,attempts:[]};n.attempts.push({coins:t.getCoins(),moves:t.getMoves()}),this.levelRecords[e]=n}},{key:"getLastCompletedLevelNumber",value:function(){var e=Object.keys(this.levelRecords).map(Number).sort();return e[e.length-1]||0}}]),e}(),te=function(e){function t(){return r()(this,t),c()(this,l()(t).call(this,{key:"boot"}))}return v()(t,e),a()(t,[{key:"create",value:function(){this.persistence.addDocument(new ee),this.scene.start("preload")}}]),t}(J),ie=i(168),ne=i.n(ie),se=function(e){function t(e,i){var n;return r()(this,t),(n=c()(this,l()(t).call(this,e,i))).listeners=void 0,n.hasSwiped=void 0,n.listeners=[],n.hasSwiped=!1,e.events.on(Phaser.Scenes.Events.START,n.startListening,ne()(n)),e.events.on(Phaser.Scenes.Events.SHUTDOWN,n.stopListening,ne()(n)),n}return v()(t,e),a()(t,[{key:"addListener",value:function(e){this.listeners.push(e)}},{key:"startListening",value:function(){this.scene.input.on(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this),this.scene.input.on(Phaser.Input.Events.POINTER_UP,this.onPointerUp,this),this.scene.input.on(Phaser.Input.Events.POINTER_MOVE,this.onPointerMove,this)}},{key:"stopListening",value:function(){this.listeners=[],this.scene.input.off(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this),this.scene.input.off(Phaser.Input.Events.POINTER_UP,this.onPointerUp,this),this.scene.input.off(Phaser.Input.Events.POINTER_MOVE,this.onPointerMove,this)}},{key:"onPointerDown",value:function(){this.hasSwiped=!1}},{key:"onPointerUp",value:function(){this.hasSwiped=!0}},{key:"onPointerMove",value:function(){if(this.scene.input.activePointer.isDown){var e=this.scene.input.activePointer.getDistanceX(),t=this.scene.input.activePointer.getDistanceY(),i=void 0;if(e>100){var s=this.scene.input.activePointer.position.x-this.scene.input.activePointer.prevPosition.x;i=s<0?n.LEFT:n.RIGHT}else if(t>100){var r=this.scene.input.activePointer.position.y-this.scene.input.activePointer.prevPosition.y;i=r<0?n.UP:n.DOWN}i&&!this.hasSwiped&&(this.hasSwiped=!0,this.listeners.forEach((function(e){return e(i)})))}}}]),t}(Phaser.Plugins.ScenePlugin),re=function(e){function t(){var e;return r()(this,t),(e=c()(this,l()(t).call(this,{key:"music"}))).levelMusic=void 0,e}return v()(t,e),a()(t,[{key:"init",value:function(){this.events.on(Phaser.Scenes.Events.SHUTDOWN,this.destroy,this)}},{key:"create",value:function(){this.levelMusic=this.sound.add("level-music",{loop:!0})}},{key:"destroy",value:function(){this.levelMusic.destroy()}},{key:"playLevelMusic",value:function(){this.levelMusic.isPlaying||(this.levelMusic.isPaused?this.levelMusic.resume():this.levelMusic.play())}},{key:"pauseLevelMusic",value:function(){this.levelMusic.pause()}},{key:"playWinSfx",value:function(){var e=this.sound.add("level-complete");return e.play(),new Promise((function(t){e.once(Phaser.Sound.Events.COMPLETE,(function(){e.destroy(),t()}))}))}},{key:"playResetSfx",value:function(){this.sound.play("level-reset")}},{key:"playCoinSfx",value:function(){this.sound.play("coin")}}]),t}(Phaser.Scene),oe=function(e){function t(){var e;return r()(this,t),(e=c()(this,l()(t).call(this,{key:"hud"}))).collectedCoinsText=void 0,e.totalCoinsText=void 0,e}return v()(t,e),a()(t,[{key:"create",value:function(e){var t=this.scene.get("dungeon");this.add.image(this.scale.width-60,this.scale.height-60,"hud-restart").setOrigin(.5).setInteractive().on(Phaser.Input.Events.POINTER_DOWN,(function(){t.resetLevel()})),e.totalCoins>0&&(this.add.image(60,this.scale.height-60+3,"coin").setOrigin(.5),this.collectedCoinsText=this.add.bitmapText(80,this.scale.height-60,"matchup-32","0").setOrigin(0,.5),this.add.bitmapText(100,this.scale.height-60,"matchup-32","/").setOrigin(0,.5),this.totalCoinsText=this.add.bitmapText(120,this.scale.height-60,"matchup-32",e.totalCoins).setOrigin(0,.5))}},{key:"setTotalCoins",value:function(e){this.totalCoinsText.setText("".concat(e))}},{key:"resetCollectedCoins",value:function(){this.totalCoinsText.setText("".concat(0))}},{key:"setCollectedCoins",value:function(e){this.collectedCoinsText.setText("".concat(e))}}]),t}(J),ae=(g.a.Scene,[te,Z,q,V,oe,re]);new g.a.Game({width:K.WIDTH,height:K.HEIGHT,scene:ae,scale:{mode:g.a.Scale.FIT,autoCenter:g.a.Scale.CENTER_HORIZONTALLY},render:{pixelArt:!0},plugins:{scene:[{key:"Phecs",plugin:p.a,mapping:"phecs"},{key:"Swipe",plugin:se,mapping:"swipe"}],global:[{key:"LevelManagerPlugin",plugin:z,mapping:"levelManager",start:!0},{key:"PersistencePlugin",plugin:$,mapping:"persistence",start:!0}]}})}});