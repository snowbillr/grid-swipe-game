!function(e){function t(t){for(var i,o,a=t[0],c=t[1],u=t[2],h=0,f=[];h<a.length;h++)o=a[h],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&f.push(r[o][0]),r[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);for(l&&l(t);f.length;)f.shift()();return s.push.apply(s,u||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],i=!0,a=1;a<n.length;a++){var c=n[a];0!==r[c]&&(i=!1)}i&&(s.splice(t--,1),e=o(o.s=n[0]))}return e}var i={},r={0:0},s=[];function o(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var l=c;s.push([1477,1]),n()}({104:function(e){e.exports=JSON.parse('{"levelGroups":[{"name":"Beginner\'s Alley","levels":[0,1,2,3],"prerequisites":[]},{"name":"Spike Lane","levels":[4,5,6],"prerequisites":[{"type":"levelGroup","name":"Beginner\'s Alley"}]}]}')},1477:function(e,t,n){"use strict";n.r(t);var i,r=n(1),s=n.n(r),o=n(2),a=n.n(o),c=n(7),u=n.n(c),l=n(8),h=n.n(l),f=n(5),d=n.n(f),v=n(44),p=n.n(v),g=n(562),y=n(563),m=n.n(y),k=n(67),b=n.n(k);!function(e){e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT"}(i||(i={}));var x=function(){function e(t,n,i){s()(this,e),this.dungeon=t,this.x=n,this.y=i,this.initialX=void 0,this.initialY=void 0,this.initialX=n,this.initialY=i}return a()(e,[{key:"move",value:function(e){switch(e){case i.UP:this.up();break;case i.DOWN:this.down();break;case i.LEFT:this.left();break;case i.RIGHT:this.right()}return this.exists()}},{key:"up",value:function(){return this.y-=1,this.exists()}},{key:"down",value:function(){return this.y+=1,this.exists()}},{key:"left",value:function(){return this.x-=1,this.exists()}},{key:"right",value:function(){return this.x+=1,this.exists()}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this.exists()}},{key:"reset",value:function(){this.x=this.initialX,this.y=this.initialY}},{key:"exists",value:function(){return this.dungeon.hasTile(this.x,this.y)}},{key:"getTile",value:function(){return this.dungeon.getTile(this.x,this.y)}},{key:"getCardinalNeighbors",value:function(){var e=[];return this.up()&&e.push({direction:i.UP,dungeonTile:this.getTile()}),this.down(),this.down()&&e.push({direction:i.DOWN,dungeonTile:this.getTile()}),this.up(),this.left()&&e.push({direction:i.LEFT,dungeonTile:this.getTile()}),this.right(),this.right()&&e.push({direction:i.RIGHT,dungeonTile:this.getTile()}),this.left(),e}}]),e}(),T=function(){function e(){s()(this,e),this.coins=void 0,this.moves=void 0,this.coins=0,this.moves=0}return a()(e,[{key:"reset",value:function(){this.coins=0,this.moves=0}},{key:"incrementCoins",value:function(){this.coins+=1}},{key:"getCoins",value:function(){return this.coins}},{key:"incrementMoves",value:function(){this.moves+=1}},{key:"getMoves",value:function(){return this.moves}}]),e}();function O(e){return e.reduce((function(e,t){var n=t.name,i=t.value;return e[n]=i,e}),{})}var w,P=function(){function e(t,n,i,r){s()(this,e),this.dungeonTiles=t,this.markers=n,this.floor=i,this.worldWidth=void 0,this.worldHeight=void 0,this.gridWidth=void 0,this.gridHeight=void 0,this.stats=void 0,this.coinCount=void 0,this.message=void 0,this.worldWidth=r.widthInPixels,this.worldHeight=r.heightInPixels,this.gridWidth=r.width,this.gridHeight=r.height,this.message=O(r.properties).message,this.coinCount=t.reduce((function(e,t){return Boolean(t.getObject("coin"))?e+1:e}),0),this.stats=new T}return a()(e,[{key:"destroy",value:function(){this.dungeonTiles.forEach((function(e){return e.destroy()})),delete this.dungeonTiles,delete this.markers,this.floor.destroy(),delete this.floor}},{key:"getMarker",value:function(e){return this.markers[e]}},{key:"getCursor",value:function(e,t){return new x(this,e,t)}},{key:"hasTile",value:function(e,t){return this.dungeonTiles.some((function(n){return n.isGridPosition(e,t)}))}},{key:"getTile",value:function(e,t){var n=this.dungeonTiles.find((function(n){return n.isGridPosition(e,t)}));if(!n)throw new Error("No tile found for ".concat(e,", ").concat(t));return n}},{key:"getWalkableNeighborTile",value:function(e,t,n){var i=this.getCursor(e,t);if(i.move(n),i.exists()){var r=i.getTile();return r.isWalkable()?r:void 0}}}]),e}(),R=function e(t,n,i,r,o){s()(this,e),this.name=t,this.gridX=n,this.gridY=i,this.worldX=r,this.worldY=o},E=n(32),I=n.n(E);function S(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(e,t)}(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r,s=!0,o=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,r=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}!function(e){e.INPUT="INPUT",e.ENTER="ENTER",e.EXIT="EXIT"}(w||(w={}));var D=function(){function e(t,n,i,r,o,a){var c;s()(this,e),this.scene=t,this.gridX=n,this.gridY=i,this.worldX=r,this.worldY=o,this.properties=a,this.behaviors=void 0,this.objects=void 0,this.behaviors=(c={},I()(c,w.INPUT,[]),I()(c,w.ENTER,[]),I()(c,w.EXIT,[]),c),this.objects=[]}return a()(e,[{key:"setObjects",value:function(e){this.objects=e}},{key:"destroy",value:function(){delete this.properties,this.objects.forEach((function(e){return e.destroy()})),this.behaviors[w.INPUT]=[],this.behaviors[w.ENTER]=[],this.behaviors[w.EXIT]=[]}},{key:"isWalkable",value:function(){return this.properties.walkable}},{key:"isObjective",value:function(){return this.properties.objective}},{key:"isGridPosition",value:function(e,t){return e===this.gridX&&t===this.gridY}},{key:"getObject",value:function(e){return this.objects.find((function(t){return t.name===e}))}},{key:"hasObject",value:function(e){return this.objects.some((function(t){return t.name===e}))}},{key:"addObject",value:function(e){this.objects.push(e)}},{key:"removeObject",value:function(e){var t=this.objects.findIndex((function(t){return t.name===e})),n=this.objects.splice(t,1);b()(n,1)[0].destroy()}},{key:"addBehavior",value:function(e,t){this.behaviors[e].push(t)}},{key:"removeBehavior",value:function(e,t){var n=this.behaviors[e],i=n.findIndex((function(e){return e.id==t.id}));n.splice(i,1)}},{key:"runBehaviors",value:function(e,t){var n,i=S(this.behaviors[e].slice().sort((function(e,t){return t.priority-e.priority})));try{for(i.s();!(n=i.n()).done;){if(n.value.run(t))break}}catch(e){i.e(e)}finally{i.f()}}}]),e}(),j=function(){function e(t,n){var i,r;s()(this,e),this.scene=void 0,this.x=void 0,this.y=void 0,this.texture=void 0,this.depth=void 0,this.originX=void 0,this.originY=void 0,this.sprite=void 0,this.scene=t,this.x=n.x,this.y=n.y,this.texture=n.texture,this.depth=n.depth,this.originX=null!==(i=n.originX)&&void 0!==i?i:.5,this.originY=null!==(r=n.originY)&&void 0!==r?r:.5}return a()(e,[{key:"onAdd",value:function(){this.sprite=this.scene.add.sprite(this.x,this.y,this.texture),this.sprite.setDepth(this.depth),this.sprite.setOrigin(this.originX,this.originY)}},{key:"destroy",value:function(){}}]),e}(),L=function(){function e(t,n){s()(this,e),this.gridX=void 0,this.gridY=void 0,this.gridX=n.gridX,this.gridY=n.gridY}return a()(e,[{key:"setGridPosition",value:function(e,t){this.gridX=e,this.gridY=t}},{key:"destroy",value:function(){}}]),e}(),N=n(129),M=function(){function e(t,n,i){s()(this,e),this.scene=void 0,this.data=void 0,this.entity=void 0,this.stateMachine=void 0,this.scene=t,this.data=n,this.entity=i}return a()(e,[{key:"onAdd",value:function(){var e=this;this.stateMachine=new N.a(this.scene,this.entity,this.data.states,this.data.initialState),this.stateMachine.start(),this.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,(function(){return e.updateStateMachine}))}},{key:"destroy",value:function(){var e=this;this.scene.events.off(Phaser.Scenes.Events.POST_UPDATE,(function(){return e.updateStateMachine}))}},{key:"updateStateMachine",value:function(){this.stateMachine.update()}}]),e}(),H=function(){function e(){s()(this,e),this.callbacks=void 0,this.currentIndex=void 0,this.callbacks=[],this.currentIndex=0}return a()(e,[{key:"addCallback",value:function(e){this.callbacks.push(e)}},{key:"runNext",value:function(){this.callbacks[this.currentIndex](),this.currentIndex+=1}}]),e}(),A=function(e,t,n){var i=e.getComponent(j).sprite,r=e.getComponent(L),s=new Phaser.Math.Vector2(r.gridX,r.gridY),o=n.dungeon.getCursor(s.x,s.y).move(t),a=new H,c=n.tweens.timeline({tweens:[{targets:[],duration:0}],paused:!0,onStart:function(){a.runNext()},onComplete:function(){a.runNext()}});a.addCallback((function(){e.getComponent(M).stateMachine.transitionTo("moving",void 0,{direction:t})}));for(var u=function(){var e=n.dungeon.getTile(s.x,s.y),u=n.dungeon.getWalkableNeighborTile(s.x,s.y,t);if(u){var l=new Phaser.Math.Vector2(u.worldX,u.worldY);c.add({targets:i,props:{x:l.x,y:l.y},duration:200,onStart:function(){a.runNext()},onComplete:function(){a.runNext()}}),a.addCallback((function(){e.runBehaviors(w.EXIT,t)})),a.addCallback((function(){r.setGridPosition(u.gridX,u.gridY),u.runBehaviors(w.ENTER,t)})),s.set(u.gridX,u.gridY)}else o=!1};o;)u();return a.addCallback((function(){n.queuedInput.length?(n.incrementCombo(),n.handleInput(),e.getComponent(M).stateMachine.transitionTo("moving",void 0,{direction:n.queuedInput})):(n.resetCombo(),e.getComponent(M).stateMachine.transitionTo("idle"))})),c},B=function(){function e(t,n,i){s()(this,e),this.scene=t,this.tile=n,this.dungeon=i,this.id=void 0,this.priority=void 0,this.id=this.generateId()}return a()(e,[{key:"generateId",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}}]),e}();function G(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var F="hud",X="preload",U="boot",Y="dungeon",_="title",W="sfx",K="debug",V="death",q="level-select";function J(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var z=[function(e){u()(n,e);var t=G(n);function n(){var e;s()(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).priority=90,e}return a()(n,[{key:"isApplicable",value:function(){return this.tile.isWalkable()}},{key:"run",value:function(e){return this.dungeon.stats.incrementMoves(),A(this.scene.hero,e,this.scene).play(),!1}}]),n}(B),function(e){u()(n,e);var t=J(n);function n(){var e;s()(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).priority=100,e}return a()(n,[{key:"isApplicable",value:function(){return this.dungeon.getCursor(this.tile.gridX,this.tile.gridY).getCardinalNeighbors().some((function(e){return e.dungeonTile.isObjective()}))}},{key:"run",value:function(e){var t,n=this;this.scene.hero.getComponent(M).stateMachine.stop();var i=this.scene.dungeon.getCursor(this.tile.gridX,this.tile.gridY);if(i.move(e),!i.getTile().isObjective())return!1;this.tile.removeObject("swipe-indicator");var r=null===(t=i.getTile().getObject("objective"))||void 0===t?void 0:t.sprite,s=new Promise((function(e){null==r||r.once(Phaser.Animations.Events.SPRITE_ANIMATION_COMPLETE,e)}));return this.scene.scene.stop(F),this.scene.sfx.pauseLevelMusic(),null==r||r.anims.play("objective-win"),Promise.all([s,this.scene.sfx.playWinSfx()]).then((function(){n.scene.cameras.main.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,(function(){n.scene.persistence.getDocument("progress").completeLevel(n.scene.levelSession.getCurrentLevel().getIndex(),n.scene.dungeon.stats),n.scene.persistence.store(),n.scene.levelSession.didCompleteLevelGroup()?n.scene.scene.start(q):(n.scene.levelSession.incrementCurrentLevelRelativeIndex(),n.scene.scene.restart())})),n.scene.cameras.main.fadeOut(700)})),!0}}]),n}(B)];function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var $=function(e){u()(n,e);var t=Q(n);function n(){var e;s()(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).priority=100,e}return a()(n,[{key:"isApplicable",value:function(){return this.tile.hasObject("coin")}},{key:"run",value:function(e){var t,n=null===(t=this.tile.getObject("coin"))||void 0===t?void 0:t.sprite;return this.scene.sfx.playCoinSfx(),this.scene.dungeon.stats.incrementCoins(),this.scene.hud.setCollectedCoins(this.scene.dungeon.stats.getCoins()),this.scene.tweens.add({targets:n,props:{y:"-=50",alpha:0},duration:200}),this.tile.removeBehavior(w.ENTER,this),!1}}]),n}(B),Z=function(){function e(t,n,i,r,o){s()(this,e),this.scene=t,this.dungeonTile=n,this.name=i,this.sprite=r}return a()(e,[{key:"destroy",value:function(){this.sprite.destroy()}}]),e}(),ee=50,te=60,ne=40,ie=40,re=40,se=60,oe=100,ae=n(90),ce=n.n(ae),ue=n(174),le=n.n(ue);function he(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var fe=function(e){u()(n,e);var t=he(n);function n(){var e;s()(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).damage=.5,e.priority=100,e}return a()(n,[{key:"setDamage",value:function(e){this.damage=e}},{key:"isApplicable",value:function(){return!1}},{key:"run",value:function(e){var t=this,n=this.scene.levelSession;if(this.scene.resetCombo(),n.subtractHealth(this.damage),this.scene.hud.updateHealth(n.getHealth(),n.getMaxHealth()),this.scene.cameras.main.shake(200,.01),n.getHealth()<=0){this.scene.sfx.pauseLevelMusic(),this.scene.sfx.playDieSfx();var i=this.scene.hero.getComponent(j);this.scene.tweens.killTweensOf(i.sprite),i.sprite.on("".concat(Phaser.Animations.Events.SPRITE_ANIMATION_KEY_COMPLETE,"hero-die"),(function(){t.scene.cameras.main.fadeOut(500,0,0,0,(function(e,n){n>=.99&&(t.scene.scene.stop(),t.scene.scene.stop(F),t.scene.scene.start(V))}))})),i.sprite.anims.play("hero-die")}else this.scene.sfx.playHurtSfx();return!1}}]),n}(B);function de(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var ve=[{name:"rock",tileIndex:50,texture:"rock",depth:ne},{name:"rock2",tileIndex:60,texture:"rock2",depth:ne},{name:"objective",tileIndex:85,texture:"objective",frame:0,depth:ie},{name:"coin",tileIndex:87,texture:"coin",frame:0,animation:"coin-spin",depth:te},{name:"spikes",tileIndex:101,texture:"spikes",frame:0,depth:re,klass:function(e){u()(o,e);var t,n,i,r=de(o);function o(e,t,n,i,a){var c,u,l;return s()(this,o),(l=r.call(this,e,t,n,i,a)).damageActorBehavior=void 0,l.hiddenDuration=void 0,l.damageActorBehavior=new fe(l.scene,l.dungeonTile,l.scene.dungeon),l.damageActorBehavior.setDamage(.5),l.hiddenDuration=null!==(c=a.hiddenDuration)&&void 0!==c?c:3e3,e.time.delayedCall(null!==(u=a.offset)&&void 0!==u?u:1e3,(function(){return l.startCycle()})),l}return a()(o,[{key:"startCycle",value:(i=le()(ce.a.mark((function e(){var t=this;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.playAnimation("spikes-peek");case 2:return e.next=4,this.playAnimation("spikes-reveal");case 4:return this.dungeonTile.addBehavior(w.ENTER,this.damageActorBehavior),e.next=7,this.wait(2e3);case 7:return e.next=9,this.playAnimation("spikes-hide");case 9:this.dungeonTile.removeBehavior(w.ENTER,this.damageActorBehavior),this.scene.time.delayedCall(this.hiddenDuration,(function(){return t.startCycle()}));case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"playAnimation",value:(n=le()(ce.a.mark((function e(t){var n=this;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){n.sprite.on("".concat(Phaser.Animations.Events.SPRITE_ANIMATION_KEY_COMPLETE).concat(t),(function(){e()})),n.sprite.anims.play(t)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"wait",value:(t=le()(ce.a.mark((function e(t){var n=this;return ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){n.scene.time.delayedCall(t,e)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),o}(Z)},{name:"swipe-indicator",texture:"swipe-indicator",frame:0,animation:"swipe-indicator-bounce",depth:se}],pe=function(){function e(t){s()(this,e),this.scene=t}return a()(e,[{key:"createByIndex",value:function(e,t,n){var i=Object.values(ve).find((function(e){return e.tileIndex===t}));if(!i)throw new Error("DungeonObjectFactory: missing properties for ".concat(t));return this.create(e,i,n)}},{key:"createByName",value:function(e,t){var n=Object.values(ve).find((function(e){return e.name===t}));if(!n)throw new Error("DungeonObjectFactory: missing properties for ".concat(t));return this.create(e,n)}},{key:"create",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t.texture,r=t.frame,s=t.depth,o=this.scene.add.sprite(e.worldX,e.worldY,i,r).setOrigin(0).setDepth(s),a=t.name,c=t.animation;c&&o.anims.play(c);var u=t.klass||Z;return new u(this.scene,e,a,o,n)}}]),e}();function ge(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var ye=[$,fe,function(e){u()(n,e);var t=ge(n);function n(){var e;s()(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).priority=100,e}return a()(n,[{key:"isApplicable",value:function(){return this.dungeon.getCursor(this.tile.gridX,this.tile.gridY).getCardinalNeighbors().some((function(e){return e.dungeonTile.isObjective()}))}},{key:"run",value:function(e){var t,n,r,s;if(this.scene.dungeon.getCursor(this.tile.gridX,this.tile.gridY).getCardinalNeighbors().forEach((function(e){var t=e.dungeonTile,n=e.direction;t.isObjective()&&(s=n)})),!s)throw new Error("EnterBehavior - ShowSwipeIndicator - no objective neighbor found");var o=(t={},I()(t,i.DOWN,0),I()(t,i.LEFT,Math.PI/2),I()(t,i.UP,Math.PI),I()(t,i.RIGHT,Math.PI+Math.PI/2),t)[s],a=(n={},I()(n,i.DOWN,16),I()(n,i.LEFT,0),I()(n,i.UP,16),I()(n,i.RIGHT,32),n)[s],c=(r={},I()(r,i.DOWN,32),I()(r,i.LEFT,16),I()(r,i.UP,0),I()(r,i.RIGHT,16),r)[s],u=new pe(this.scene).createByName(this.tile,"swipe-indicator");return u.sprite.setPosition(this.tile.worldX+a,this.tile.worldY+c).setOrigin(.5).setRotation(o),this.tile.addObject(u),!1}}]),n}(B)];function me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var ke=[function(e){u()(n,e);var t=me(n);function n(){var e;s()(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).priority=100,e}return a()(n,[{key:"isApplicable",value:function(){return this.dungeon.getCursor(this.tile.gridX,this.tile.gridY).getCardinalNeighbors().some((function(e){return e.dungeonTile.isObjective()}))}},{key:"run",value:function(e){return this.tile.removeObject("swipe-indicator"),!1}}]),n}(B)],be=function(){function e(t){s()(this,e),this.scene=t,this.dungeonObjectFactory=void 0,this.dungeonObjectFactory=new pe(t)}return a()(e,[{key:"create",value:function(e,t,n,i,r,s){var o=this,a={walkable:r.walkable.reduce((function(e,t){return e&&t}),!0),objective:r.objective.reduce((function(e,t){return e||t}),!1)},c=new D(this.scene,e,t,n,i,a),u=(s||[]).map((function(e){var t=e.index,n=e.properties;return o.dungeonObjectFactory.createByIndex(c,t,n)}));return c.setObjects(u),c}},{key:"addBehaviors",value:function(e,t){var n=this;z.forEach((function(i){var r=new i(n.scene,e,t);r.isApplicable()&&e.addBehavior(w.INPUT,r)})),ye.forEach((function(i){var r=new i(n.scene,e,t);r.isApplicable()&&e.addBehavior(w.ENTER,r)})),ke.forEach((function(i){var r=new i(n.scene,e,t);r.isApplicable()&&e.addBehavior(w.EXIT,r)}))}}]),e}(),xe=function(){function e(t){s()(this,e),this.scene=t,this.dungeonTileFactory=void 0,this.dungeonTileFactory=new be(t)}return a()(e,[{key:"createDungeon",value:function(e,t,n){var i=this,r=this.scene.add.tilemap(e);r.addTilesetImage("dungeon-tileset","dungeon-spritesheet");var s=this.createFloor(r,t,n);r.setLayer("floor");var o=this.createDungeonTiles(r,s),a=this.createDungeonMarkers(r,t,n),c=new P(o,a,s,r);return o.forEach((function(e){return i.dungeonTileFactory.addBehaviors(e,c)})),c}},{key:"createFloor",value:function(e,t,n){return e.createDynamicLayer("floor","dungeon-tileset",t,n)}},{key:"createDungeonTiles",value:function(e,t){var n=this,i=new Te;t.forEachTile((function(e){Object.entries(e.properties).forEach((function(t){var n=b()(t,2),r=n[0],s=n[1];i.addKeyValue(e.x,e.y,r,s)}))}),this,0,0,e.width,e.height,{isNotEmpty:!0}),e.getObjectLayer("objects").objects.map((function(e){return{gridX:Math.round(e.x/32),gridY:Math.round((e.y-32)/32),index:e.gid,properties:O(e.properties)}})).forEach((function(e){i.addObject(e.gridX,e.gridY,e.index,e.properties),Object.entries(e.properties).forEach((function(t){var n=b()(t,2),r=n[0],s=n[1];i.addKeyValue(e.gridX,e.gridY,r,s)}))}));var r=[];return i.forEach((function(t,i,s){var o=e.tileToWorldXY(t.x,t.y),a=n.dungeonTileFactory.create(t.x,t.y,o.x,o.y,i,s);r.push(a)})),r}},{key:"createDungeonMarkers",value:function(e,t,n){return e.getObjectLayer("markers").objects.reduce((function(i,r){var s=e.getTileAtWorldXY(r.x+t,r.y+n),o=e.tileToWorldXY(s.x,s.y);return i[r.name]=new R(r.name,s.x,s.y,o.x,o.y),i}),{})}}]),e}(),Te=function(){function e(){s()(this,e),this.tileData=void 0,this.tileObjects=void 0,this.tileData={},this.tileObjects={}}return a()(e,[{key:"addKeyValue",value:function(e,t,n,i){var r,s,o=this.coordinatesToTileKey(e,t);this.tileData[o]=null!==(r=this.tileData[o])&&void 0!==r?r:{},this.tileData[o][n]=null!==(s=this.tileData[o][n])&&void 0!==s?s:[],this.tileData[o][n].push(i)}},{key:"addObject",value:function(e,t,n,i){var r,s=this.coordinatesToTileKey(e,t);this.tileObjects[s]=null!==(r=this.tileObjects[s])&&void 0!==r?r:[],this.tileObjects[s].push({index:n,properties:i})}},{key:"forEach",value:function(e){var t=this;Object.entries(this.tileData).forEach((function(n){var i=b()(n,2),r=i[0],s=i[1],o=t.tileKeyToCoordinates(r);e(o,s,t.tileObjects[r])}))}},{key:"coordinatesToTileKey",value:function(e,t){return"".concat(e,",").concat(t)}},{key:"tileKeyToCoordinates",value:function(e){var t=e.split(",").map(Number),n=b()(t,2);return{x:n[0],y:n[1]}}}]),e}(),Oe=[new N.b("idle",[],{onEnter:function(e,t){e.getComponent(j).sprite.anims.play("hero-idle")}}),new N.b("moving",[],{onEnter:function(e,t,n){var r=e.getComponent(j).sprite;n.direction===i.LEFT?r.flipX=!0:n.direction===i.RIGHT&&(r.flipX=!1),r.anims.play("hero-run")}})],we={components:[{component:j,data:{texture:"hero",depth:ee,originX:0,originY:.5}},L,{component:M,data:{states:Oe,initialState:Oe[0]}}]},Pe={WIDTH:342,HEIGHT:608};function Re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var Ee=function(e){u()(n,e);var t=Re(n);function n(){var e;s()(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).persistence=void 0,e.phecs=void 0,e.swipe=void 0,e.levelSession=void 0,e}return a()(n,[{key:"sfx",get:function(){return this.scene.get(W)}}]),n}(Phaser.Scene),Ie=[{multiplier:1,steps:4,max:!1},{multiplier:2,steps:5,max:!1},{multiplier:3,steps:6,max:!1},{multiplier:4,steps:0,max:!0}],Se=function(){function e(){s()(this,e),this.currentLevel=void 0,this.currentStep=void 0,this.currentLevel=0,this.currentStep=0}return a()(e,[{key:"increment",value:function(){Ie[this.currentLevel].max||(this.currentStep+=1,this.currentStep>Ie[this.currentLevel].steps-1&&(this.currentLevel+=1,this.currentStep=0))}},{key:"reset",value:function(){this.currentLevel=0,this.currentStep=0}},{key:"isMax",value:function(){return this.currentLevel===Ie.length-1}},{key:"getMultiplier",value:function(){return Ie[this.currentLevel].multiplier}},{key:"getStep",value:function(){return this.currentStep}}]),e}();function Ce(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var De=function(e){u()(n,e);var t=Ce(n);function n(){var e;return s()(this,n),(e=t.call(this,{key:Y})).dungeon=void 0,e.hero=void 0,e.hud=void 0,e.comboTracker=void 0,e.queuedInput=void 0,e.comboTracker=new Se,e.queuedInput=[],e}return a()(n,[{key:"init",value:function(){this.phecs.register.prefab("hero",we)}},{key:"create",value:function(){var e=this,t=this.levelSession.getCurrentLevel(),n=new xe(this);this.dungeon=n.createDungeon(t.getKey(),0,0);var i=this.dungeon.getMarker("hero-start");this.hero=this.phecs.add.prefab("hero",{gridX:i.gridX,gridY:i.gridY},i.worldX,i.worldY),this.swipe.addListener((function(t){e.queueInput(t)}));var r=this.calculateCameraBounds(),s=r.x,o=r.y,a=r.width,c=r.height;this.cameras.main.setBounds(s,o,a,c),this.cameras.main.setBackgroundColor(2429722),this.cameras.main.startFollow(this.hero.getComponent(j).sprite),this.cameras.main.fadeIn(500);var u=this.add.bitmapText(this.scale.width/2,this.scale.height/2,"matchup-64",this.dungeon.message).setMaxWidth(this.scale.width-20).setCenterAlign().setOrigin(.5).setScrollFactor(0).setDepth(oe),l=u.getTextBounds().local.width;u.setX(this.scale.width+l),this.tweens.add({targets:u,props:{x:-l},duration:2500,ease:m()(.15,.85,.85,.15),onComplete:function(){return u.destroy()}}),this.sfx.playLevelMusic(),this.scene.launch(F,{totalCoins:this.dungeon.coinCount,maxHealth:this.persistence.getDocument("player-stats").getMaxHealth(),currentHealth:this.levelSession.getHealth()}),this.hud=this.scene.get(F)}},{key:"resetLevel",value:function(){var e=this;this.dungeon.stats.reset(),this.sfx.pauseLevelMusic(),this.sfx.playResetSfx(),this.cameras.main.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,(function(){e.scene.stop(),e.scene.restart()})),this.cameras.main.fadeOut(1e3)}},{key:"queueInput",value:function(e){this.queuedInput.push(e),"idle"===this.hero.getComponent(M).stateMachine.currentState.id&&this.handleInput()}},{key:"handleInput",value:function(){if(0!==this.queuedInput.length){var e=this.queuedInput.splice(0,1)[0],t=this.hero.getComponent(L);this.dungeon.getTile(t.gridX,t.gridY).runBehaviors(w.INPUT,e)}}},{key:"incrementCombo",value:function(){this.comboTracker.isMax()||(this.comboTracker.increment(),this.sfx.playComboSfx(this.comboTracker.getMultiplier(),this.comboTracker.getStep()),this.hud.comboMeter.increaseTo(this.comboTracker.getMultiplier(),this.comboTracker.getStep()))}},{key:"resetCombo",value:function(){1===this.comboTracker.getMultiplier()&&0===this.comboTracker.getStep()||(this.comboTracker.reset(),this.hud.comboMeter.reset())}},{key:"calculateCameraBounds",value:function(){var e=0,t=0,n=this.dungeon.worldWidth,i=this.dungeon.worldHeight;return n<Pe.WIDTH&&(e-=(Pe.WIDTH-n)/2),i<Pe.HEIGHT&&(t-=(Pe.HEIGHT-i)/2),{x:e,y:t,width:n,height:i}}}]),n}(Ee),je=n(104),Le=function(){function e(t){s()(this,e),this.loader=t}return a()(e,[{key:"load",value:function(){var e=this;this.getLevelLoadData().forEach((function(t){e.loader.tilemapTiledJSON(t.levelKey,t.levelFilePath)}))}},{key:"getLevelLoadData",value:function(){return this.getLevelIndices().map((function(e){return{levelKey:"level-".concat(String(e).padStart(3,"0")),levelFilePath:"assets/levels/".concat(String(e).padStart(3,"0"),".json")}}))}},{key:"getLevelIndices",value:function(){var e=new Set;return je.levelGroups.forEach((function(t){t.levels.forEach((function(t){e.add(t)}))})),Array.from(e)}}]),e}();function Ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var Me=function(e){u()(n,e);var t=Ne(n);function n(){return s()(this,n),t.call(this,{key:X})}return a()(n,[{key:"preload",value:function(){this.cameras.main.setBackgroundColor(4007227);var e=Pe.WIDTH/2,t=Pe.HEIGHT/2,n=(this.add.rectangle(e-75,t,150,40,14306872).setOrigin(0,.5),this.add.rectangle(e-75+3,t,0,34,15633710).setOrigin(0,.5));this.load.on(Phaser.Loader.Events.PROGRESS,(function(e){var t=144*e;n.width=t})),this.load.pack("sfx-pack","assets/sfx/pack.json"),this.load.pack("music-pack","assets/music/pack.json"),this.load.pack("objects-pack","assets/objects/pack.json"),this.load.pack("fonts-pack","assets/fonts/pack.json"),this.load.pack("interface-pack","assets/interface/pack.json"),this.load.pack("characters-pack","assets/characters/pack.json"),this.load.image("dungeon-spritesheet","assets/maps/dungeon-spritesheet.png"),new Le(this.load).load()}},{key:"create",value:function(){this.persistence.read(),this.scene.start(_)}}]),n}(Ee);function He(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var Ae=function(e){u()(n,e);var t=He(n);function n(){return s()(this,n),t.call(this,{key:_})}return a()(n,[{key:"create",value:function(){var e=this;this.cameras.main.setBackgroundColor(4007227),this.scene.launch(W);var t=0,n=this.add.image(-300,100,"logo").setInteractive().on(Phaser.Input.Events.POINTER_DOWN,(function(){(t+=1)>=5&&e.scene.get(K).showScene()})),i=0===this.persistence.getDocument("progress").getLastCompletedLevelNumber()?"Play":"Continue",r=this.addButton(this.cameras.main.centerX,Pe.HEIGHT+100,i,(function(){e.scene.start(q)}));this.tweens.timeline({tweens:[{targets:n,props:{x:this.cameras.main.centerX},ease:Phaser.Math.Easing.Quadratic.Out,duration:750},{targets:r,props:{y:300},offset:300,ease:Phaser.Math.Easing.Quadratic.Out,duration:550}]})}},{key:"addButton",value:function(e,t,n,i,r){var s=this.add.container(e,t).setSize(240,80).setInteractive().on(Phaser.Input.Events.POINTER_DOWN,i),o=this.add.rectangle(0,0,240,80,14306872).setOrigin(.5),a=this.add.rectangle(0,0,230,70,15633710).setOrigin(.5),c=this.add.bitmapText(0,-5,null!=r?r:"matchup-64",n).setOrigin(.5);return s.add(o),s.add(a),s.add(c),s}}]),n}(Ee);function Be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var Ge=function(e){u()(n,e);var t=Be(n);function n(e){var i;return s()(this,n),(i=t.call(this,e)).documents=void 0,i.documents=[],i}return a()(n,[{key:"addDocument",value:function(e){this.documents.push(e)}},{key:"getDocument",value:function(e){var t=this.documents.find((function(t){return t.name===e}));if(!t)throw new Error("No persistence document found: ".concat(e));return t}},{key:"store",value:function(){var e=this.documents.reduce((function(e,t){return e[t.name]=t.toJson(),e}),{});window.localStorage.setItem("scooch-dungeon",JSON.stringify(e))}},{key:"read",value:function(){var e=this;try{var t=window.localStorage.getItem("scooch-dungeon")||"{}",n=JSON.parse(t);Object.entries(n).forEach((function(t){var n=b()(t,2),i=n[0],r=n[1],s=e.documents.find((function(e){return e.name===i}));null==s||s.fromJson(r)}))}catch(e){confirm("Bad save data. Clear?")&&(localStorage.removeItem("scooch-dungeon"),location.reload())}}}]),n}(Phaser.Plugins.BasePlugin),Fe=function(){function e(t){s()(this,e),this.index=t}return a()(e,[{key:"getKey",value:function(){return"level-".concat(String(this.index).padStart(3,"0"))}},{key:"getIndex",value:function(){return this.index}}]),e}(),Xe=function(){function e(t){s()(this,e),this.name=t,this.levelIndices=void 0,this.prerequisites=void 0;var n=je.levelGroups.find((function(e){return e.name===t}));if(!n)throw new Error("Missing level group: ".concat(t));this.levelIndices=n.levels,this.prerequisites=n.prerequisites}return a()(e,[{key:"getLevels",value:function(){return this.levelIndices.map((function(e){return new Fe(e)}))}},{key:"getRelativeLevel",value:function(e){if(e>=this.levelIndices.length)throw new Error("relative level index > group level count");return new Fe(this.levelIndices[e])}},{key:"getLevelCount",value:function(){return this.levelIndices.length}},{key:"getPrerequisiteLevelGroups",value:function(){return this.prerequisites.map((function(t){return new e(t.name)}))}}]),e}(),Ue=function(){function e(){s()(this,e),this.name="progress",this.levelRecords={}}return a()(e,[{key:"toJson",value:function(){return{levelRecords:this.levelRecords}}},{key:"fromJson",value:function(e){this.levelRecords=e.levelRecords}},{key:"completeLevel",value:function(e,t){var n,i=null!==(n=this.levelRecords[e])&&void 0!==n?n:{levelNumber:e,attempts:[]};i.attempts.push({coins:t.getCoins(),moves:t.getMoves()}),this.levelRecords[e]=i}},{key:"getLastCompletedLevelNumber",value:function(){var e,t=Object.keys(this.levelRecords).map(Number).sort();return null!==(e=t[t.length-1])&&void 0!==e?e:-1}},{key:"isLevelCompleted",value:function(e){return this.levelRecords[e]}},{key:"getLevelGroupUnlocked",value:function(e){var t=this;return new Xe(e).getPrerequisiteLevelGroups().every((function(e){return e.getLevels().every((function(e){return t.isLevelCompleted(e.getIndex())}))}))}}]),e}(),Ye=function(){function e(){s()(this,e),this.name="settings",this.muted=!1}return a()(e,[{key:"toJson",value:function(){return{muted:this.muted}}},{key:"fromJson",value:function(e){var t;this.muted=null!==(t=e.muted)&&void 0!==t&&t}},{key:"getMuted",value:function(){return this.muted}},{key:"setMuted",value:function(e){this.muted=e}}]),e}(),_e=function(){function e(){s()(this,e),this.name="player-stats",this.maxHealth=2}return a()(e,[{key:"toJson",value:function(){return{maxHealth:this.maxHealth}}},{key:"fromJson",value:function(e){var t;this.maxHealth=null!==(t=e.maxHealth)&&void 0!==t?t:2}},{key:"getMaxHealth",value:function(){return this.maxHealth}},{key:"setMaxHealth",value:function(e){this.maxHealth=e}}]),e}();function We(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var Ke=function(e){u()(n,e);var t=We(n);function n(){return s()(this,n),t.call(this,{key:U})}return a()(n,[{key:"create",value:function(){this.persistence.addDocument(new Ue),this.persistence.addDocument(new Ye),this.persistence.addDocument(new _e),this.scene.start(X)}}]),n}(Ee),Ve=n(172),qe=n.n(Ve);function Je(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var ze=function(e){u()(n,e);var t=Je(n);function n(e,i){var r;return s()(this,n),(r=t.call(this,e,i)).listeners=void 0,r.hasSwiped=void 0,r.listeners=[],r.hasSwiped=!1,e.events.on(Phaser.Scenes.Events.START,r.startListening,qe()(r)),e.events.on(Phaser.Scenes.Events.SHUTDOWN,r.stopListening,qe()(r)),r}return a()(n,[{key:"addListener",value:function(e){this.listeners.push(e)}},{key:"removeListener",value:function(e){var t=this.listeners.findIndex((function(t){return t===e}));t>=0&&this.listeners.splice(t,1)}},{key:"startListening",value:function(){this.scene.input.on(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this),this.scene.input.on(Phaser.Input.Events.POINTER_UP,this.onPointerUp,this),this.scene.input.on(Phaser.Input.Events.POINTER_MOVE,this.onPointerMove,this)}},{key:"stopListening",value:function(){this.listeners=[],this.scene.input.off(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this),this.scene.input.off(Phaser.Input.Events.POINTER_UP,this.onPointerUp,this),this.scene.input.off(Phaser.Input.Events.POINTER_MOVE,this.onPointerMove,this)}},{key:"onPointerDown",value:function(){this.hasSwiped=!1}},{key:"onPointerUp",value:function(){this.hasSwiped=!0}},{key:"onPointerMove",value:function(){if(this.scene.input.activePointer.isDown){var e=this.scene.input.activePointer.getDistanceX(),t=this.scene.input.activePointer.getDistanceY(),n=void 0;if(e>75){var r=this.scene.input.activePointer.position.x-this.scene.input.activePointer.prevPosition.x;n=r<0?i.LEFT:i.RIGHT}else if(t>75){var s=this.scene.input.activePointer.position.y-this.scene.input.activePointer.prevPosition.y;n=s<0?i.UP:i.DOWN}n&&!this.hasSwiped&&(this.hasSwiped=!0,this.listeners.slice().forEach((function(e){e(n)})))}}}]),n}(Phaser.Plugins.ScenePlugin);function Qe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var $e,Ze=function(e){u()(n,e);var t=Qe(n);function n(){var e;return s()(this,n),(e=t.call(this,{key:W})).levelMusic=void 0,e}return a()(n,[{key:"init",value:function(){this.sound.mute=this.persistence.getDocument("settings").getMuted()}},{key:"create",value:function(){this.levelMusic=this.sound.add("level-music",{loop:!0})}},{key:"playLevelMusic",value:function(){this.levelMusic.isPlaying||(this.levelMusic.isPaused?this.levelMusic.resume():this.levelMusic.play())}},{key:"pauseLevelMusic",value:function(){this.levelMusic.pause()}},{key:"playWinSfx",value:function(){var e=this.sound.add("level-complete");return e.play(),new Promise((function(t){e.once(Phaser.Sound.Events.COMPLETE,(function(){e.destroy(),t()}))}))}},{key:"playResetSfx",value:function(){this.sound.play("level-reset")}},{key:"playCoinSfx",value:function(){this.sound.play("coin")}},{key:"playHurtSfx",value:function(){this.sound.play("hurt")}},{key:"playDieSfx",value:function(){this.sound.play("die")}},{key:"playComboSfx",value:function(e,t){this.sound.playAudioSprite("combo","".concat(e,"-").concat(t),{volume:.3})}}]),n}(Ee),et=n(173);!function(e){e[e.NONE=0]="NONE",e[e.BACKGROUND=1]="BACKGROUND",e[e.BACKGROUND_INVERSE=2]="BACKGROUND_INVERSE"}($e||($e={}));var tt,nt=function(){function e(t,n,i,r,o,a){var c,u;s()(this,e),this.scene=void 0,this.gameObject=void 0,this.scene=t;var l=this.normalizeContent(o);if(l instanceof Phaser.GameObjects.BitmapText){var h=l.getTextBounds();c=h.global.width,u=h.global.height}else{var f=l.getBounds();c=f.width,u=f.height}var d="";r===$e.BACKGROUND?d="hud-button":r===$e.BACKGROUND_INVERSE&&(d="hud-button-inverse"),d?(this.gameObject=new et.NinePatch(t,n,i,1,1,d,void 0,{top:16,bottom:16,left:16,right:16}),this.gameObject.resize(c+32,u+32)):(this.gameObject=new Phaser.GameObjects.Container(t,n,i),this.gameObject.setSize(c,u)),this.gameObject.add(l),this.gameObject.setInteractive(),this.gameObject.on(Phaser.Input.Events.POINTER_UP,a),t.add.existing(this.gameObject)}return a()(e,[{key:"normalizeContent",value:function(e){return"string"==typeof e?this.scene.add.image(0,0,e):e}}]),e}(),it=function(){function e(t,n,i){var r=this;s()(this,e),this.gameObject=void 0,this.scene=void 0,this.settings=void 0,this.volumeIcon=void 0,this.scene=t,this.settings=t.persistence.getDocument("settings"),this.volumeIcon=t.add.image(0,0,"hud-volume"),this.updateVolumeIcon(),this.gameObject=new nt(t,n,i,$e.BACKGROUND_INVERSE,this.volumeIcon,(function(){return r.toggleVolume()})).gameObject}return a()(e,[{key:"toggleVolume",value:function(){var e=!this.scene.sound.mute;this.scene.sound.mute=e,this.settings.setMuted(e),this.updateVolumeIcon(),this.scene.persistence.store()}},{key:"updateVolumeIcon",value:function(){this.volumeIcon.setFrame(this.settings.getMuted()?1:0)}}]),e}();!function(e){e[e.EMPTY=0]="EMPTY",e[e.HALF=1]="HALF",e[e.FULL=2]="FULL"}(tt||(tt={}));var rt=function(){function e(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:tt.FULL;s()(this,e),this.gameObject=void 0,this.gameObject=t.add.sprite(n,i,"hud-heart",2).setOrigin(1,.5),this.setValue(r)}return a()(e,[{key:"setValue",value:function(e){this.gameObject.setFrame(this.valueToFrame(e))}},{key:"valueToFrame",value:function(e){switch(e){case tt.EMPTY:return 0;case tt.HALF:return 1;case tt.FULL:return 2;default:return 0}}}]),e}(),st=function(){function e(t,n,i){s()(this,e),this.scene=t,this.gameObject=void 0,this.gameObject=t.add.sprite(n,i,"combo-meter-1")}return a()(e,[{key:"increaseTo",value:function(e,t){this.gameObject.setTexture(this.getTexture(e),t),this.scene.tweens.add({targets:this.gameObject,props:{scale:0===t?1.4:1.1},yoyo:!0,duration:100})}},{key:"reset",value:function(){this.gameObject.setTexture(this.getTexture(1),0),this.scene.tweens.timeline({targets:this.gameObject,tweens:[{props:{x:"+=5"},yoyo:!0,duration:50},{props:{x:"-=5"},yoyo:!0,duration:50},{props:{x:"+=5"},yoyo:!0,duration:50}]})}},{key:"getTexture",value:function(e){switch(e){case 1:return"combo-meter-1";case 2:return"combo-meter-2";case 3:return"combo-meter-3";case 4:return"combo-meter-max"}throw new Error("ComboMeter - missing texture for multiplier")}}]),e}();function ot(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var at=function(e){u()(n,e);var t=ot(n);function n(){var e;return s()(this,n),(e=t.call(this,{key:F})).collectedCoinsText=void 0,e.totalCoinsText=void 0,e.hearts=void 0,e.comboMeter=void 0,e}return a()(n,[{key:"create",value:function(e){this.addPauseIcon(),this.addRestartIcon(),this.addCoinsIndicator(e.totalCoins),this.addHearts(e.maxHealth),this.updateHealth(e.currentHealth,e.maxHealth),this.addComboMeter()}},{key:"setTotalCoins",value:function(e){this.totalCoinsText.setText("".concat(e))}},{key:"resetCollectedCoins",value:function(){this.totalCoinsText.setText("".concat(0))}},{key:"setCollectedCoins",value:function(e){this.collectedCoinsText.setText("".concat(e))}},{key:"updateHealth",value:function(e,t){for(var n=this.calculateHearts(e,t),i=n.fullHearts,r=n.halfHearts,s=n.emptyHearts,o=0;o<i;o++)this.hearts[o].setValue(tt.FULL);for(var a=i;a<i+r;a++)this.hearts[a].setValue(tt.HALF);for(var c=i+r;c<i+r+s;c++)this.hearts[c].setValue(tt.EMPTY)}},{key:"addPauseIcon",value:function(){var e=this;new nt(this,60,this.scale.height-60,$e.NONE,"hud-pause",(function(){if(!e.scene.isPaused(Y)){e.scene.pause(Y);var t=e.scale.width/2,n=e.scale.height/2,i=e.add.rectangle(0,0,e.scale.width,e.scale.height,0,.5).setOrigin(0).setAlpha(0),r=e.add.ninePatch(t,-300,250,300,"menubox",null,{top:16,bottom:16,left:16,right:16});r.add([e.add.bitmapText(0,-125,"matchup-32","Paused").setOrigin(.5),e.add.image(113,-138,"hud-close").setInteractive().on(Phaser.Input.Events.POINTER_UP,(function(){e.tweens.add({targets:r,props:{y:-300},duration:400,ease:Phaser.Math.Easing.Cubic.In,onComplete:function(){r.destroy()}}),e.tweens.add({targets:i,props:{alpha:0},duration:400,onComplete:function(){i.destroy()}}),e.scene.resume(Y)})),new nt(e,0,-50,$e.BACKGROUND,e.add.bitmapText(0,0,"matchup-24","Quit to title").setOrigin(.5),(function(){e.sfx.pauseLevelMusic(),e.cameras.main.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,(function(){e.scene.stop(),e.scene.stop(Y),e.scene.start(_)})),e.cameras.main.fadeOut(1e3)})).gameObject,new nt(e,0,10,$e.BACKGROUND,e.add.bitmapText(0,0,"matchup-24","Back to level select").setOrigin(.5),(function(){e.sfx.pauseLevelMusic(),e.cameras.main.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,(function(){e.scene.stop(),e.scene.stop(Y),e.scene.start(q)})),e.cameras.main.fadeOut(1e3)})).gameObject,new it(e,0,100).gameObject]),e.tweens.add({targets:r,props:{y:n},duration:400,ease:Phaser.Math.Easing.Cubic.Out}),e.tweens.add({targets:i,props:{alpha:1},duration:400})}}))}},{key:"addRestartIcon",value:function(){var e=this;new nt(this,this.scale.width-60,this.scale.height-60,$e.NONE,"hud-restart",(function(){e.scene.get(Y).resetLevel()}))}},{key:"addCoinsIndicator",value:function(e){var t=this.scale.width-60;e>0&&(this.add.image(t-40,60,"coin").setOrigin(.5),this.collectedCoinsText=this.add.bitmapText(t-20,57,"matchup-32","0").setOrigin(0,.5),this.add.bitmapText(t,57,"matchup-32","/").setOrigin(0,.5),this.totalCoinsText=this.add.bitmapText(t+20,57,"matchup-32","".concat(e)).setOrigin(0,.5))}},{key:"addHearts",value:function(e){var t=this,n=this.calculateHearts(e,e),i=n.fullHearts,r=n.halfHearts,s=n.emptyHearts;this.hearts=Array.from({length:i+r+s},(function(e,n){return new rt(t,60+40*n,60)})),this.updateHealth(e,e)}},{key:"calculateHearts",value:function(e,t){var n=Math.floor(e),i=Math.ceil(e-n);return{fullHearts:n,halfHearts:i,emptyHearts:t-i-n}}},{key:"addComboMeter",value:function(){this.comboMeter=new st(this,Pe.WIDTH/2,60)}}]),n}(Ee);function ct(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var ut={fontSize:"16px",color:"#fff",backgroundColor:"#44BF95",stroke:"#000000",strokeThickness:3,padding:{left:10,right:10,top:5,bottom:5}},lt={fontSize:"38px",color:"#fff",stroke:"#000000",strokeThickness:3},ht=function(e){u()(n,e);var t=ct(n);function n(){var e;return s()(this,n),(e=t.call(this,{key:K})).buttons=void 0,e.buttons=[],e}return a()(n,[{key:"create",value:function(){var e=this;this.input.keyboard.createCombo("debug",{resetOnMatch:!0}),this.input.keyboard.on("keycombomatch",(function(t){t.keyCodes.join()===[68,69,66,85,71].join()&&e.showScene()})),this.add.rectangle(0,0,this.scale.width,this.scale.height,0,.6).setOrigin(0),this.add.text(this.scale.width/2,100,"DEBUG menu",lt).setOrigin(.5),this.addButtons(),this.hideScene(),this.scene.bringToTop(),this.scene.launch(U)}},{key:"addButtons",value:function(){var e=this;this.addButton(this.scale.width-30,30,"X",(function(){return e.hideScene()})),this.addButton(this.scale.width/2,150,"clear save data",(function(){localStorage.clear(),location.reload()}))}},{key:"addButton",value:function(e,t,n,i){this.buttons.push(this.add.text(e,t,n,ut).setOrigin(.5).setInteractive({useHandCursor:!0}).on(Phaser.Input.Events.POINTER_DOWN,i))}},{key:"showScene",value:function(){this.scene.setVisible(!0),this.buttons.forEach((function(e){return e.input.enabled=!0}))}},{key:"hideScene",value:function(){this.buttons.forEach((function(e){return e.input.enabled=!1})),this.scene.setVisible(!1)}}]),n}(Phaser.Scene);function ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var dt=function(e){u()(n,e);var t=ft(n);function n(){return s()(this,n),t.call(this,{key:V})}return a()(n,[{key:"create",value:function(e){var t=this;this.cameras.main.setBackgroundColor("#3d253b");var n=this.add.image(Pe.WIDTH/2,125,"skull");this.tweens.add({targets:n,props:{y:150},yoyo:!0,loop:-1,ease:Phaser.Math.Easing.Quadratic.InOut}),new nt(this,Pe.WIDTH/2,Pe.HEIGHT/2-50,$e.BACKGROUND,this.add.bitmapText(0,0,"matchup-24","Restart Level Set").setOrigin(.5),(function(){t.levelSession.restart(),t.fadeToScene(Y,{levelGroup:e.levelGroup,currentLevelIndex:0})})),new nt(this,Pe.WIDTH/2,Pe.HEIGHT/2+25,$e.BACKGROUND,this.add.bitmapText(0,0,"matchup-24","Quit to Title").setOrigin(.5),(function(){return t.fadeToScene(_)}))}},{key:"fadeToScene",value:function(e,t){var n=this;this.cameras.main.fadeOut(500,0,0,0,(function(i,r){r>.99&&n.scene.start(e,t)}))}}]),n}(Ee),vt=n(564),pt=n.n(vt);function gt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var yt=-650,mt=-525,kt=function(e){u()(n,e);var t=gt(n);function n(){return s()(this,n),t.call(this,{key:q})}return a()(n,[{key:"create",value:function(){var e=this;this.cameras.main.setBackgroundColor(4007227),this.add.image(0,96,"level-select-background").setOrigin(0,1).setAlpha(.5),this.input.on(Phaser.Input.Events.POINTER_MOVE,(function(){if(e.input.activePointer.isDown){var t=e.input.activePointer.prevPosition.y-e.input.activePointer.position.y,n=e.cameras.main.scrollY+t;e.cameras.main.scrollY=Phaser.Math.Clamp(n,yt,mt)}}));var t=this.scale.width/2,n=0;je.levelGroups.forEach((function(i){var r=new bt(e,i.name,t,n);n-=r.gameObject.getBounds().height- -96})),this.add.bitmapText(this.scale.width/2,50,"matchup-64","Level Select").setOrigin(.5).setScrollFactor(0),this.cameras.main.scrollY=mt}}]),n}(Ee),bt=function e(t,n,i,r){s()(this,e),this.scene=t,this.levelGroupName=n,this.gameObject=void 0;var o=t.persistence.getDocument("progress"),a=t.persistence.getDocument("player-stats"),c=new Xe(n),u=c.getLevels(),l=t.add.sprite(0,0,"level-go");o.getLevelGroupUnlocked(n)?l.setFrame(0).setInteractive().on(Phaser.Input.Events.POINTER_DOWN,(function(){return l.setFrame(1)})).on(Phaser.Input.Events.POINTER_OUT,(function(){return l.setFrame(0)})).on(Phaser.Input.Events.POINTER_UP,(function(){l.setFrame(0),t.levelSession.begin({levelGroup:c,currentLevelRelativeIndex:0,maxHealth:a.getMaxHealth()}),t.scene.start(Y)})):l.setFrame(2);var h=l.height+16,f=t.add.bitmapText(0,-h,"matchup-32",c.name).setOrigin(.5),d=f.getTextBounds().local.height+24,v=u.map((function(e,n){return new xt(t,e.getIndex(),0,-40*n-h-d)})),p=32*u.length+8*(u.length+1);this.gameObject=t.add.container(i,r,[t.add.rectangle(0,-24-h,64,p,11771529,.5).setOrigin(.5,1).setStrokeStyle(4,14262374),f].concat(pt()(v.map((function(e){return e.gameObject}))),[l]))},xt=function e(t,n,i,r){var o,a;s()(this,e),this.scene=t,this.levelNumber=n,this.gameObject=void 0,this.button=void 0,this.star=void 0,this.enabled=!0,this.completed=!1;var c=t.persistence.getDocument("progress").isLevelCompleted(n);this.enabled=(null==c||null===(o=c.attempts)||void 0===o?void 0:o.length)>0,this.completed=(null==c||null===(a=c.attempts)||void 0===a?void 0:a.length)>0,this.gameObject=t.add.container(i,r),this.gameObject.add([this.button=t.add.sprite(0,0,"level-button"),this.star=t.add.sprite(0,-1,"star")]),this.gameObject.setSize(32,32),this.enabled?this.button.setFrame(0):this.button.setFrame(1),this.star.setVisible(this.completed)};function Tt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}var Ot={key:"LevelSessionPlugin",plugin:function(e){u()(n,e);var t=Tt(n);function n(e){var i;return s()(this,n),(i=t.call(this,e)).levelGroup=void 0,i.currentLevelRelativeIndex=0,i.maxHealth=0,i.health=0,i}return a()(n,[{key:"begin",value:function(e){this.levelGroup=e.levelGroup,this.currentLevelRelativeIndex=e.currentLevelRelativeIndex,this.maxHealth=e.maxHealth,this.health=e.maxHealth}},{key:"restart",value:function(){this.health=this.maxHealth}},{key:"getLevelGroup",value:function(){return this.levelGroup}},{key:"incrementCurrentLevelRelativeIndex",value:function(){this.currentLevelRelativeIndex=this.currentLevelRelativeIndex+1}},{key:"didCompleteLevelGroup",value:function(){return this.currentLevelRelativeIndex+1>=this.levelGroup.getLevelCount()}},{key:"getCurrentLevel",value:function(){return this.levelGroup.getRelativeLevel(this.currentLevelRelativeIndex)}},{key:"subtractHealth",value:function(e){this.health-=e}},{key:"setHealth",value:function(e){this.health=e}},{key:"getHealth",value:function(){return this.health}},{key:"getMaxHealth",value:function(){return this.maxHealth}}]),n}(Phaser.Plugins.BasePlugin),mapping:"levelSession",start:!0};function wt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=d()(e);if(t){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return h()(this,n)}}p.a.Scene;var Pt=[ht,Ke,Me,Ae,De,dt,kt,at,Ze];new p.a.Game({width:Pe.WIDTH,height:Pe.HEIGHT,scene:Pt,scale:{mode:p.a.Scale.FIT,autoCenter:p.a.Scale.CENTER_BOTH},render:{pixelArt:!0},plugins:{scene:[{key:"Phecs",plugin:g.a,mapping:"phecs"},{key:"Swipe",plugin:ze,mapping:"swipe"}],global:[{key:"PersistencePlugin",plugin:Ge,mapping:"persistence",start:!0},{key:"NinePatchPlugin",plugin:et.NinePatchPlugin,start:!0},Ot]}})}});