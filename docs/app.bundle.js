!function(t){function e(e){for(var i,o,a=e[0],u=e[1],c=e[2],l=0,f=[];l<a.length;l++)o=a[l],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&f.push(r[o][0]),r[o]=0;for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(t[i]=u[i]);for(h&&h(e);f.length;)f.shift()();return s.push.apply(s,c||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],i=!0,a=1;a<n.length;a++){var u=n[a];0!==r[u]&&(i=!1)}i&&(s.splice(e--,1),t=o(o.s=n[0]))}return t}var i={},r={0:0},s=[];function o(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=i,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var a=window.webpackJsonp=window.webpackJsonp||[],u=a.push.bind(a);a.push=e,a=a.slice();for(var c=0;c<a.length;c++)e(a[c]);var h=u;s.push([1472,1]),n()}({1472:function(t,e,n){"use strict";n.r(e);var i,r=n(1),s=n.n(r),o=n(2),a=n.n(o),u=n(7),c=n.n(u),h=n(8),l=n.n(h),f=n(5),d=n.n(f),v=n(44),p=n.n(v),g=n(559),y=n(560),m=n.n(y),b=n(67),k=n.n(b);!function(t){t.UP="UP",t.DOWN="DOWN",t.LEFT="LEFT",t.RIGHT="RIGHT"}(i||(i={}));var x=function(){function t(e,n,i){s()(this,t),this.dungeon=e,this.x=n,this.y=i,this.initialX=void 0,this.initialY=void 0,this.initialX=n,this.initialY=i}return a()(t,[{key:"move",value:function(t){switch(t){case i.UP:this.up();break;case i.DOWN:this.down();break;case i.LEFT:this.left();break;case i.RIGHT:this.right()}return this.exists()}},{key:"up",value:function(){return this.y-=1,this.exists()}},{key:"down",value:function(){return this.y+=1,this.exists()}},{key:"left",value:function(){return this.x-=1,this.exists()}},{key:"right",value:function(){return this.x+=1,this.exists()}},{key:"set",value:function(t,e){return this.x=t,this.y=e,this.exists()}},{key:"reset",value:function(){this.x=this.initialX,this.y=this.initialY}},{key:"exists",value:function(){return this.dungeon.hasTile(this.x,this.y)}},{key:"getTile",value:function(){return this.dungeon.getTile(this.x,this.y)}},{key:"getCardinalNeighbors",value:function(){var t=[];return this.up()&&t.push({direction:i.UP,dungeonTile:this.getTile()}),this.down(),this.down()&&t.push({direction:i.DOWN,dungeonTile:this.getTile()}),this.up(),this.left()&&t.push({direction:i.LEFT,dungeonTile:this.getTile()}),this.right(),this.right()&&t.push({direction:i.RIGHT,dungeonTile:this.getTile()}),this.left(),t}}]),t}(),T=function(){function t(){s()(this,t),this.coins=void 0,this.moves=void 0,this.coins=0,this.moves=0}return a()(t,[{key:"reset",value:function(){this.coins=0,this.moves=0}},{key:"incrementCoins",value:function(){this.coins+=1}},{key:"getCoins",value:function(){return this.coins}},{key:"incrementMoves",value:function(){this.moves+=1}},{key:"getMoves",value:function(){return this.moves}}]),t}();var w,P=function(){function t(e,n,i,r){var o;s()(this,t),this.dungeonTiles=e,this.markers=n,this.floor=i,this.worldWidth=void 0,this.worldHeight=void 0,this.gridWidth=void 0,this.gridHeight=void 0,this.stats=void 0,this.coinCount=void 0,this.message=void 0,this.worldWidth=r.widthInPixels,this.worldHeight=r.heightInPixels,this.gridWidth=r.width,this.gridHeight=r.height,this.message=(o=r.properties,o.reduce((function(t,e){var n=e.name,i=e.value;return t[n]=i,t}),{})).message,this.coinCount=e.reduce((function(t,e){return Boolean(e.getObject("coin"))?t+1:t}),0),this.stats=new T}return a()(t,[{key:"destroy",value:function(){this.dungeonTiles.forEach((function(t){return t.destroy()})),delete this.dungeonTiles,delete this.markers,this.floor.destroy(),delete this.floor}},{key:"getMarker",value:function(t){return this.markers[t]}},{key:"getCursor",value:function(t,e){return new x(this,t,e)}},{key:"hasTile",value:function(t,e){return this.dungeonTiles.some((function(n){return n.isGridPosition(t,e)}))}},{key:"getTile",value:function(t,e){var n=this.dungeonTiles.find((function(n){return n.isGridPosition(t,e)}));if(!n)throw new Error("No tile found for ".concat(t,", ").concat(e));return n}},{key:"getWalkableNeighborTile",value:function(t,e,n){var i=this.getCursor(t,e);if(i.move(n),i.exists()){var r=i.getTile();return r.isWalkable()?r:void 0}}}]),t}(),R=function t(e,n,i,r,o){s()(this,t),this.name=e,this.gridX=n,this.gridY=i,this.worldX=r,this.worldY=o},O=n(32),E=n.n(O);function I(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(!t)return;if("string"==typeof t)return C(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(t,e)}(t))){var e=0,n=function(){};return{s:n,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r,s=!0,o=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}!function(t){t.INPUT="INPUT",t.ENTER="ENTER",t.EXIT="EXIT"}(w||(w={}));var D=function(){function t(e,n,i,r,o,a){var u;s()(this,t),this.scene=e,this.gridX=n,this.gridY=i,this.worldX=r,this.worldY=o,this.properties=a,this.behaviors=void 0,this.objects=void 0,this.behaviors=(u={},E()(u,w.INPUT,[]),E()(u,w.ENTER,[]),E()(u,w.EXIT,[]),u),this.objects=[]}return a()(t,[{key:"setObjects",value:function(t){this.objects=t}},{key:"destroy",value:function(){delete this.properties,this.objects.forEach((function(t){return t.destroy()})),this.behaviors[w.INPUT]=[],this.behaviors[w.ENTER]=[],this.behaviors[w.EXIT]=[]}},{key:"isWalkable",value:function(){return this.properties.walkable}},{key:"isObjective",value:function(){return this.properties.objective}},{key:"isGridPosition",value:function(t,e){return t===this.gridX&&e===this.gridY}},{key:"getObject",value:function(t){return this.objects.find((function(e){return e.name===t}))}},{key:"hasObject",value:function(t){return this.objects.some((function(e){return e.name===t}))}},{key:"addObject",value:function(t){this.objects.push(t)}},{key:"removeObject",value:function(t){var e=this.objects.findIndex((function(e){return e.name===t})),n=this.objects.splice(e,1);k()(n,1)[0].destroy()}},{key:"addBehavior",value:function(t,e){this.behaviors[t].push(e)}},{key:"removeBehavior",value:function(t,e){var n=this.behaviors[t],i=n.findIndex((function(t){return t.id==e.id}));n.splice(i,1)}},{key:"runBehaviors",value:function(t,e){var n,i=I(this.behaviors[t].slice().sort((function(t,e){return e.priority-t.priority})));try{for(i.s();!(n=i.n()).done;){if(n.value.run(e))break}}catch(t){i.e(t)}finally{i.f()}}}]),t}(),N=function(){function t(e,n){var i,r;s()(this,t),this.scene=void 0,this.x=void 0,this.y=void 0,this.texture=void 0,this.depth=void 0,this.originX=void 0,this.originY=void 0,this.sprite=void 0,this.scene=e,this.x=n.x,this.y=n.y,this.texture=n.texture,this.depth=n.depth,this.originX=null!==(i=n.originX)&&void 0!==i?i:.5,this.originY=null!==(r=n.originY)&&void 0!==r?r:.5}return a()(t,[{key:"onAdd",value:function(){this.sprite=this.scene.add.sprite(this.x,this.y,this.texture),this.sprite.setDepth(this.depth),this.sprite.setOrigin(this.originX,this.originY)}},{key:"destroy",value:function(){}}]),t}(),S=function(){function t(e,n){s()(this,t),this.gridX=void 0,this.gridY=void 0,this.gridX=n.gridX,this.gridY=n.gridY}return a()(t,[{key:"setGridPosition",value:function(t,e){this.gridX=t,this.gridY=e}},{key:"destroy",value:function(){}}]),t}(),j=n(128),M=function(){function t(e,n,i){s()(this,t),this.scene=void 0,this.data=void 0,this.entity=void 0,this.stateMachine=void 0,this.scene=e,this.data=n,this.entity=i}return a()(t,[{key:"onAdd",value:function(){var t=this;this.stateMachine=new j.a(this.scene,this.entity,this.data.states,this.data.initialState),this.stateMachine.start(),this.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,(function(){return t.updateStateMachine}))}},{key:"destroy",value:function(){var t=this;this.scene.events.off(Phaser.Scenes.Events.POST_UPDATE,(function(){return t.updateStateMachine}))}},{key:"updateStateMachine",value:function(){this.stateMachine.update()}}]),t}(),H=function(){function t(){s()(this,t),this.callbacks=void 0,this.currentIndex=void 0,this.callbacks=[],this.currentIndex=0}return a()(t,[{key:"addCallback",value:function(t){this.callbacks.push(t)}},{key:"runNext",value:function(){this.callbacks[this.currentIndex](),this.currentIndex+=1}}]),t}(),L=function(t,e,n){var i=t.getComponent(N).sprite,r=t.getComponent(S),s=new Phaser.Math.Vector2(r.gridX,r.gridY),o=n.dungeon.getCursor(s.x,s.y).move(e),a=new H,u=n.tweens.timeline({tweens:[{targets:[],duration:0}],paused:!0,onStart:function(){a.runNext()},onComplete:function(){a.runNext()}});a.addCallback((function(){t.getComponent(M).stateMachine.transitionTo("moving",void 0,{direction:e})}));for(var c=function(){var t=n.dungeon.getTile(s.x,s.y),c=n.dungeon.getWalkableNeighborTile(s.x,s.y,e);if(c){var h=new Phaser.Math.Vector2(c.worldX,c.worldY);u.add({targets:i,props:{x:h.x,y:h.y},duration:200,onStart:function(){a.runNext()},onComplete:function(){a.runNext()}}),a.addCallback((function(){t.runBehaviors(w.EXIT,e)})),a.addCallback((function(){r.setGridPosition(c.gridX,c.gridY),c.runBehaviors(w.ENTER,e)})),s.set(c.gridX,c.gridY)}else o=!1};o;)c();return a.addCallback((function(){n.queuedInput.length?(n.handleInput(),t.getComponent(M).stateMachine.transitionTo("moving",void 0,{direction:n.queuedInput})):t.getComponent(M).stateMachine.transitionTo("idle")})),u},A=function(){function t(e,n,i){s()(this,t),this.scene=e,this.tile=n,this.dungeon=i,this.id=void 0,this.priority=void 0,this.id=this.generateId()}return a()(t,[{key:"generateId",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}}]),t}();function B(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var X="hud",W="preload",U="boot",F="dungeon",Y="title",_="sfx",G="debug",V="death";function K(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var J=[function(t){c()(n,t);var e=B(n);function n(){var t;s()(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).priority=90,t}return a()(n,[{key:"isApplicable",value:function(){return this.tile.isWalkable()}},{key:"run",value:function(t){return this.dungeon.stats.incrementMoves(),L(this.scene.hero,t,this.scene).play(),!1}}]),n}(A),function(t){c()(n,t);var e=K(n);function n(){var t;s()(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).priority=100,t}return a()(n,[{key:"isApplicable",value:function(){return this.dungeon.getCursor(this.tile.gridX,this.tile.gridY).getCardinalNeighbors().some((function(t){return t.dungeonTile.isObjective()}))}},{key:"run",value:function(t){var e,n=this;this.scene.hero.getComponent(M).stateMachine.stop();var i=this.scene.dungeon.getCursor(this.tile.gridX,this.tile.gridY);if(i.move(t),!i.getTile().isObjective())return!1;this.tile.removeObject("swipe-indicator");var r=null===(e=i.getTile().getObject("objective"))||void 0===e?void 0:e.sprite,s=new Promise((function(t){null==r||r.once(Phaser.Animations.Events.SPRITE_ANIMATION_COMPLETE,t)}));return this.scene.scene.stop(X),this.scene.sfx.pauseLevelMusic(),null==r||r.anims.play("objective-win"),Promise.all([s,this.scene.sfx.playWinSfx()]).then((function(){n.scene.levelManager.hasNextLevel()?(n.scene.cameras.main.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,(function(){n.scene.persistence.getDocument("progress").completeLevel(n.scene.levelManager.getCurrentLevelNumber(),n.scene.dungeon.stats),n.scene.persistence.store(),n.scene.levelManager.setCurrentLevelNumber(n.scene.levelManager.getCurrentLevelNumber()+1),n.scene.scene.restart()})),n.scene.cameras.main.fadeOut(700)):console.log("beat all the levels")})),!0}}]),n}(A)];function q(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var z=function(t){c()(n,t);var e=q(n);function n(){var t;s()(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).priority=100,t}return a()(n,[{key:"isApplicable",value:function(){return this.tile.hasObject("coin")}},{key:"run",value:function(t){var e,n=null===(e=this.tile.getObject("coin"))||void 0===e?void 0:e.sprite;return this.scene.sfx.playCoinSfx(),this.scene.dungeon.stats.incrementCoins(),this.scene.hud.setCollectedCoins(this.scene.dungeon.stats.getCoins()),this.scene.tweens.add({targets:n,props:{y:"-=50",alpha:0},duration:200}),this.tile.removeBehavior(w.ENTER,this),!1}}]),n}(A),Q=function(){function t(e,n,i,r){s()(this,t),this.scene=e,this.dungeonTile=n,this.name=i,this.sprite=r}return a()(t,[{key:"destroy",value:function(){this.sprite.destroy()}}]),t}(),Z=50,$=60,tt=40,et=40,nt=40,it=60,rt=100,st=n(90),ot=n.n(st),at=n(173),ut=n.n(at),ct=function(){function t(e,n){s()(this,t),this.maxHealth=void 0,this.currentHealth=void 0,this.maxHealth=n.maxHealth,this.currentHealth=n.maxHealth}return a()(t,[{key:"onAdd",value:function(){}},{key:"destroy",value:function(){}},{key:"subtract",value:function(t){this.currentHealth-=t}}]),t}();function ht(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var lt=function(t){c()(n,t);var e=ht(n);function n(){var t;s()(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).damage=.5,t.priority=100,t}return a()(n,[{key:"setDamage",value:function(t){this.damage=t}},{key:"isApplicable",value:function(){return!1}},{key:"run",value:function(t){var e=this,n=this.scene.hero.getComponent(ct);if(n.subtract(this.damage),this.scene.hud.updateHealth(n.currentHealth,n.maxHealth),this.scene.cameras.main.shake(200,.01),n.currentHealth<=0){var i=this.scene.hero.getComponent(N);this.scene.tweens.killTweensOf(i.sprite),i.sprite.on("".concat(Phaser.Animations.Events.SPRITE_ANIMATION_KEY_COMPLETE,"hero-die"),(function(){e.scene.cameras.main.fadeOut(500,0,0,0,(function(t,n){n>=.99&&(e.scene.scene.stop(),e.scene.scene.stop(X),e.scene.scene.start(V))}))})),i.sprite.anims.play("hero-die")}return!1}}]),n}(A);function ft(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var dt=[{name:"rock",tileIndex:50,texture:"rock",depth:tt},{name:"objective",tileIndex:85,texture:"objective",frame:0,depth:et},{name:"coin",tileIndex:87,texture:"coin",frame:0,animation:"coin-spin",depth:$},{name:"spikes",tileIndex:101,texture:"spikes",frame:0,depth:nt,klass:function(t){c()(o,t);var e,n,i,r=ft(o);function o(t,e,n,i){var a;return s()(this,o),(a=r.call(this,t,e,n,i)).damageActorBehavior=void 0,a.damageActorBehavior=new lt(a.scene,a.dungeonTile,a.scene.dungeon),a.damageActorBehavior.setDamage(.5),t.time.addEvent({loop:!0,delay:7e3,startAt:6e3,callback:function(){return a.startCycle()}}),a}return a()(o,[{key:"startCycle",value:(i=ut()(ot.a.mark((function t(){return ot.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.playAnimation("spikes-peek");case 2:return t.next=4,this.playAnimation("spikes-reveal");case 4:return this.dungeonTile.addBehavior(w.ENTER,this.damageActorBehavior),t.next=7,this.wait(2e3);case 7:return t.next=9,this.playAnimation("spikes-hide");case 9:this.dungeonTile.removeBehavior(w.ENTER,this.damageActorBehavior);case 10:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"playAnimation",value:(n=ut()(ot.a.mark((function t(e){var n=this;return ot.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){n.sprite.on("".concat(Phaser.Animations.Events.SPRITE_ANIMATION_KEY_COMPLETE).concat(e),(function(){t()})),n.sprite.anims.play(e)})));case 1:case"end":return t.stop()}}),t)}))),function(t){return n.apply(this,arguments)})},{key:"wait",value:(e=ut()(ot.a.mark((function t(e){var n=this;return ot.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){n.scene.time.delayedCall(e,t)})));case 1:case"end":return t.stop()}}),t)}))),function(t){return e.apply(this,arguments)})}]),o}(Q)},{name:"swipe-indicator",texture:"swipe-indicator",frame:0,animation:"swipe-indicator-bounce",depth:it}],vt=function(){function t(e){s()(this,t),this.scene=e}return a()(t,[{key:"createByIndex",value:function(t,e){var n=Object.values(dt).find((function(t){return t.tileIndex===e}));if(!n)throw new Error("DungeonObjectFactory: missing properties for ".concat(e));return this.create(t,n)}},{key:"createByName",value:function(t,e){var n=Object.values(dt).find((function(t){return t.name===e}));if(!n)throw new Error("DungeonObjectFactory: missing properties for ".concat(e));return this.create(t,n)}},{key:"create",value:function(t,e){var n=e.texture,i=e.frame,r=e.depth,s=this.scene.add.sprite(t.worldX,t.worldY,n,i).setOrigin(0).setDepth(r),o=e.name,a=e.animation;return a&&s.anims.play(a),new(e.klass||Q)(this.scene,t,o,s)}}]),t}();function pt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var gt=[z,lt,function(t){c()(n,t);var e=pt(n);function n(){var t;s()(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).priority=100,t}return a()(n,[{key:"isApplicable",value:function(){return this.dungeon.getCursor(this.tile.gridX,this.tile.gridY).getCardinalNeighbors().some((function(t){return t.dungeonTile.isObjective()}))}},{key:"run",value:function(t){var e,n,r,s;if(this.scene.dungeon.getCursor(this.tile.gridX,this.tile.gridY).getCardinalNeighbors().forEach((function(t){var e=t.dungeonTile,n=t.direction;e.isObjective()&&(s=n)})),!s)throw new Error("EnterBehavior - ShowSwipeIndicator - no objective neighbor found");var o=(e={},E()(e,i.DOWN,0),E()(e,i.LEFT,Math.PI/2),E()(e,i.UP,Math.PI),E()(e,i.RIGHT,Math.PI+Math.PI/2),e)[s],a=(n={},E()(n,i.DOWN,16),E()(n,i.LEFT,0),E()(n,i.UP,16),E()(n,i.RIGHT,32),n)[s],u=(r={},E()(r,i.DOWN,32),E()(r,i.LEFT,16),E()(r,i.UP,0),E()(r,i.RIGHT,16),r)[s],c=new vt(this.scene).createByName(this.tile,"swipe-indicator");return c.sprite.setPosition(this.tile.worldX+a,this.tile.worldY+u).setOrigin(.5).setRotation(o),this.tile.addObject(c),!1}}]),n}(A)];function yt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var mt=[function(t){c()(n,t);var e=yt(n);function n(){var t;s()(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).priority=100,t}return a()(n,[{key:"isApplicable",value:function(){return this.dungeon.getCursor(this.tile.gridX,this.tile.gridY).getCardinalNeighbors().some((function(t){return t.dungeonTile.isObjective()}))}},{key:"run",value:function(t){return this.tile.removeObject("swipe-indicator"),!1}}]),n}(A)],bt=function(){function t(e){s()(this,t),this.scene=e,this.dungeonObjectFactory=void 0,this.dungeonObjectFactory=new vt(e)}return a()(t,[{key:"create",value:function(t,e,n,i,r){var s=this,o={walkable:r.walkable.reduce((function(t,e){return t&&e}),!0),objective:r.objective.reduce((function(t,e){return t||e}),!1)},a=new D(this.scene,t,e,n,i,o),u=(r.objects||[]).map((function(t){return s.dungeonObjectFactory.createByIndex(a,t)}));return a.setObjects(u),a}},{key:"addBehaviors",value:function(t,e){var n=this;J.forEach((function(i){var r=new i(n.scene,t,e);r.isApplicable()&&t.addBehavior(w.INPUT,r)})),gt.forEach((function(i){var r=new i(n.scene,t,e);r.isApplicable()&&t.addBehavior(w.ENTER,r)})),mt.forEach((function(i){var r=new i(n.scene,t,e);r.isApplicable()&&t.addBehavior(w.EXIT,r)}))}}]),t}(),kt=function(){function t(e){s()(this,t),this.scene=e,this.dungeonTileFactory=void 0,this.dungeonTileFactory=new bt(e)}return a()(t,[{key:"createDungeon",value:function(t,e,n){var i=this,r=this.scene.add.tilemap(t);r.addTilesetImage("dungeon-tileset","dungeon-spritesheet");var s=this.createFloor(r,e,n);r.setLayer("floor");var o=this.createDungeonTiles(r,s),a=this.createDungeonMarkers(r,e,n),u=new P(o,a,s,r);return o.forEach((function(t){return i.dungeonTileFactory.addBehaviors(t,u)})),u}},{key:"createFloor",value:function(t,e,n){return t.createDynamicLayer("floor","dungeon-tileset",e,n)}},{key:"createDungeonTiles",value:function(t,e){var n=this,i=new xt;e.forEachTile((function(t){Object.entries(t.properties).forEach((function(e){var n=k()(e,2),r=n[0],s=n[1];i.addKeyValue(t.x,t.y,r,s)}))}),this,0,0,t.width,t.height,{isNotEmpty:!0}),t.getLayer("objects").data.flat().filter((function(t){return-1!==t.index})).forEach((function(t){i.addKeyValue(t.x,t.y,"objects",t.index),Object.entries(t.properties).forEach((function(e){var n=k()(e,2),r=n[0],s=n[1];i.addKeyValue(t.x,t.y,r,s)}))}));var r=[];return i.forEach((function(e,i){var s=t.tileToWorldXY(e.x,e.y),o=n.dungeonTileFactory.create(e.x,e.y,s.x,s.y,i);r.push(o)})),r}},{key:"createDungeonMarkers",value:function(t,e,n){return t.getObjectLayer("markers").objects.reduce((function(i,r){var s=t.getTileAtWorldXY(r.x+e,r.y+n),o=t.tileToWorldXY(s.x,s.y);return i[r.name]=new R(r.name,s.x,s.y,o.x,o.y),i}),{})}}]),t}(),xt=function(){function t(){s()(this,t),this.tileData=void 0,this.tileData={}}return a()(t,[{key:"addKeyValue",value:function(t,e,n,i){var r,s,o=this.coordinatesToTileKey(t,e);this.tileData[o]=null!==(r=this.tileData[o])&&void 0!==r?r:{},this.tileData[o][n]=null!==(s=this.tileData[o][n])&&void 0!==s?s:[],this.tileData[o][n].push(i)}},{key:"forEach",value:function(t){var e=this;Object.entries(this.tileData).forEach((function(n){var i=k()(n,2),r=i[0],s=i[1],o=e.tileKeyToCoordinates(r);t(o,s)}))}},{key:"coordinatesToTileKey",value:function(t,e){return"".concat(t,",").concat(e)}},{key:"tileKeyToCoordinates",value:function(t){var e=t.split(",").map(Number),n=k()(e,2);return{x:n[0],y:n[1]}}}]),t}(),Tt=[new j.b("idle",[],{onEnter:function(t,e){t.getComponent(N).sprite.anims.play("hero-idle")}}),new j.b("moving",[],{onEnter:function(t,e,n){var r=t.getComponent(N).sprite;n.direction===i.LEFT?r.flipX=!0:n.direction===i.RIGHT&&(r.flipX=!1),r.anims.play("hero-run")}})],wt={components:[{component:N,data:{texture:"hero",depth:Z,originX:0,originY:.5}},S,{component:M,data:{states:Tt,initialState:Tt[0]}},{component:ct,data:{maxHealth:2}}]},Pt={WIDTH:342,HEIGHT:608};function Rt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var Ot=function(t){c()(n,t);var e=Rt(n);function n(){var t;s()(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(t=e.call.apply(e,[this].concat(r))).persistence=void 0,t.phecs=void 0,t.levelManager=void 0,t.swipe=void 0,t}return a()(n,[{key:"sfx",get:function(){return this.scene.get(_)}}]),n}(Phaser.Scene);function Et(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var It=function(t){c()(n,t);var e=Et(n);function n(){var t;return s()(this,n),(t=e.call(this,{key:F})).dungeon=void 0,t.hero=void 0,t.hud=void 0,t.queuedInput=void 0,t.queuedInput=[],t}return a()(n,[{key:"init",value:function(){this.phecs.register.prefab("hero",wt)}},{key:"create",value:function(){var t=this,e=new kt(this);this.dungeon=e.createDungeon(this.levelManager.getCurrentLevelKey(),0,0);var n=this.dungeon.getMarker("hero-start");this.hero=this.phecs.add.prefab("hero",{gridX:n.gridX,gridY:n.gridY},n.worldX,n.worldY),this.swipe.addListener((function(e){t.queueInput(e)}));var i=this.calculateCameraBounds(),r=i.x,s=i.y,o=i.width,a=i.height;this.cameras.main.setBounds(r,s,o,a),this.cameras.main.setBackgroundColor(2429722),this.cameras.main.startFollow(this.hero.getComponent(N).sprite),this.cameras.main.fadeIn(500);var u=this.add.bitmapText(this.scale.width/2,this.scale.height/2,"matchup-64",this.dungeon.message).setMaxWidth(this.scale.width-20).setCenterAlign().setOrigin(.5).setScrollFactor(0).setDepth(rt),c=u.getTextBounds().local.width;u.setX(this.scale.width+c),this.tweens.add({targets:u,props:{x:-c},duration:2500,ease:m()(.15,.85,.85,.15),onComplete:function(){return u.destroy()}}),this.sfx.playLevelMusic(),this.scene.launch(X,{totalCoins:this.dungeon.coinCount,maxHealth:this.hero.getComponent(ct).maxHealth}),this.hud=this.scene.get(X)}},{key:"resetLevel",value:function(){var t=this;this.dungeon.stats.reset(),this.sfx.pauseLevelMusic(),this.sfx.playResetSfx(),this.cameras.main.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,(function(){t.scene.stop(),t.scene.restart()})),this.cameras.main.fadeOut(1e3)}},{key:"queueInput",value:function(t){this.queuedInput.push(t),"idle"===this.hero.getComponent(M).stateMachine.currentState.id&&this.handleInput()}},{key:"handleInput",value:function(){if(0!==this.queuedInput.length){var t=this.queuedInput.splice(0,1)[0],e=this.hero.getComponent(S);this.dungeon.getCursor(e.gridX,e.gridY).getTile().runBehaviors(w.INPUT,t)}}},{key:"calculateCameraBounds",value:function(){var t=0,e=0,n=this.dungeon.worldWidth,i=this.dungeon.worldHeight;return n<Pt.WIDTH&&(t-=(Pt.WIDTH-n)/2),i<Pt.HEIGHT&&(e-=(Pt.HEIGHT-i)/2),{x:t,y:e,width:n,height:i}}}]),n}(Ot);function Ct(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var Dt=Array.from({length:5},(function(t,e){return e+1})).reduce((function(t,e){var n=String(e).padStart(3,"0");return t[e]="level-".concat(n),t}),{}),Nt=function(t){c()(n,t);var e=Ct(n);function n(t){var i;return s()(this,n),(i=e.call(this,t)).currentLevelNumber=void 0,i.currentLevelNumber=0,i}return a()(n,[{key:"setCurrentLevelNumber",value:function(t){this.currentLevelNumber=t}},{key:"getCurrentLevelNumber",value:function(){return this.currentLevelNumber}},{key:"hasNextLevel",value:function(){return this.hasLevel(this.currentLevelNumber+1)}},{key:"hasLevel",value:function(t){return Boolean(Dt[null!=t?t:this.currentLevelNumber])}},{key:"getCurrentLevelKey",value:function(){return Dt[this.currentLevelNumber]}}]),n}(Phaser.Plugins.BasePlugin);function St(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var jt=function(t){c()(n,t);var e=St(n);function n(){return s()(this,n),e.call(this,{key:W})}return a()(n,[{key:"preload",value:function(){this.cameras.main.setBackgroundColor(4007227);var t=Pt.WIDTH/2,e=Pt.HEIGHT/2,n=(this.add.rectangle(t-75,e,150,40,14306872).setOrigin(0,.5),this.add.rectangle(t-75+3,e,0,34,15633710).setOrigin(0,.5));this.load.on(Phaser.Loader.Events.PROGRESS,(function(t){var e=144*t;n.width=e})),this.load.audio("coin",["assets/sfx/coin.mp3","assets/sfx/coin.ogg"]),this.load.audio("die",["assets/sfx/die.mp3","assets/sfx/die.ogg"]),this.load.audio("level-complete",["assets/sfx/level-complete.mp3","assets/sfx/level-complete.ogg"]),this.load.audio("level-reset",["assets/sfx/level-reset.mp3","assets/sfx/level-reset.ogg"]),this.load.audio("level-music",["assets/music/level-music.mp3","assets/music/level-music.ogg"]),this.load.audio("level-complete-music",["assets/music/level-complete-music.mp3","assets/music/level-complete-music.ogg"]),this.load.image("logo","assets/logo/scooch-dungeon-logo.png"),this.load.bitmapFont("matchup-64","assets/fonts/matchup-64.png","assets/fonts/matchup-64.xml"),this.load.bitmapFont("matchup-32","assets/fonts/matchup-32.png","assets/fonts/matchup-32.xml"),this.load.bitmapFont("matchup-24","assets/fonts/matchup-24.png","assets/fonts/matchup-24.xml"),this.load.spritesheet("hud-heart","assets/interface/hud-heart.png",{frameWidth:32,frameHeight:28}),this.load.image("hud-close","assets/interface/hud-close.png"),this.load.image("hud-restart","assets/images/hud-restart.png"),this.load.image("hud-pause","assets/interface/hud-pause.png"),this.load.image("hud-button","assets/interface/hud-button.png"),this.load.image("hud-button-inverse","assets/interface/hud-button-inverse.png"),this.load.spritesheet("hud-volume","assets/interface/volume-indicator.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("swipe-indicator","assets/interface/swipe-indicator.png",{frameWidth:32,frameHeight:32}),this.load.animation("swipe-indicator-animations","assets/interface/swipe-indicator-animations.json"),this.load.image("menubox","assets/interface/menubox.png"),this.load.image("dungeon-spritesheet","assets/maps/dungeon-spritesheet.png"),this.load.spritesheet("objective","assets/objects/objective.png",{frameWidth:32,frameHeight:32}),this.load.animation("objective-animations","assets/objects/objective-animations.json"),this.load.spritesheet("coin","assets/objects/coin.png",{frameWidth:32,frameHeight:32}),this.load.animation("coin-animations","assets/objects/coin-animations.json"),this.load.image("rock","assets/objects/rock.png"),this.load.spritesheet("spikes","assets/objects/spikes.png",{frameWidth:32,frameHeight:32}),this.load.animation("spikes-animations","assets/objects/spikes-animations.json"),this.load.image("skull","assets/images/skull.png");for(var i=1;i<=5;i++){var r=String(i).padStart(3,"0");this.load.tilemapTiledJSON("level-".concat(r),"assets/levels/".concat(r,".json"))}this.load.spritesheet("hero","assets/characters/hero/spritesheet.png",{frameWidth:32,frameHeight:56}),this.load.animation("hero-animations","assets/characters/hero/animations.json")}},{key:"create",value:function(){this.persistence.read(),this.scene.start(Y)}}]),n}(Ot);function Mt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var Ht=function(t){c()(n,t);var e=Mt(n);function n(){return s()(this,n),e.call(this,{key:Y})}return a()(n,[{key:"create",value:function(){var t=this;this.cameras.main.setBackgroundColor(4007227);var e=0,n=this.add.image(-300,100,"logo").setScale(.6).setInteractive().on(Phaser.Input.Events.POINTER_DOWN,(function(){(e+=1)>=5&&t.scene.get(G).showScene()})),i=0===this.persistence.getDocument("progress").getLastCompletedLevelNumber()?"Play":"Continue",r=this.addButton(this.cameras.main.centerX,Pt.HEIGHT+100,i,(function(){var e=t.persistence.getDocument("progress");t.levelManager.setCurrentLevelNumber(e.getLastCompletedLevelNumber()+1),t.scene.launch(_),t.scene.start(F)}));this.tweens.timeline({tweens:[{targets:n,props:{x:this.cameras.main.centerX},ease:Phaser.Math.Easing.Quadratic.Out,duration:750},{targets:r,props:{y:300},offset:300,ease:Phaser.Math.Easing.Quadratic.Out,duration:550}]})}},{key:"addButton",value:function(t,e,n,i,r){var s=this.add.container(t,e).setSize(240,80).setInteractive().on(Phaser.Input.Events.POINTER_DOWN,i),o=this.add.rectangle(0,0,240,80,14306872).setOrigin(.5),a=this.add.rectangle(0,0,230,70,15633710).setOrigin(.5),u=this.add.bitmapText(0,-5,null!=r?r:"matchup-64",n).setOrigin(.5);return s.add(o),s.add(a),s.add(u),s}}]),n}(Ot);function Lt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var At=function(t){c()(n,t);var e=Lt(n);function n(t){var i;return s()(this,n),(i=e.call(this,t)).documents=void 0,i.documents=[],i}return a()(n,[{key:"addDocument",value:function(t){this.documents.push(t)}},{key:"getDocument",value:function(t){var e=this.documents.find((function(e){return e.name===t}));if(!e)throw new Error("No persistence document found: ".concat(t));return e}},{key:"store",value:function(){var t=this.documents.reduce((function(t,e){return t[e.name]=e.toJson(),t}),{});window.localStorage.setItem("scooch-dungeon",JSON.stringify(t))}},{key:"read",value:function(){var t=this;try{var e=window.localStorage.getItem("scooch-dungeon")||"{}",n=JSON.parse(e);Object.entries(n).forEach((function(e){var n=k()(e,2),i=n[0],r=n[1],s=t.documents.find((function(t){return t.name===i}));null==s||s.fromJson(r)}))}catch(t){confirm("Bad save data. Clear?")&&(localStorage.removeItem("scooch-dungeon"),location.reload())}}}]),n}(Phaser.Plugins.BasePlugin),Bt=function(){function t(){s()(this,t),this.name="progress",this.levelRecords={}}return a()(t,[{key:"toJson",value:function(){return{levelRecords:this.levelRecords}}},{key:"fromJson",value:function(t){this.levelRecords=t.levelRecords}},{key:"completeLevel",value:function(t,e){var n,i=null!==(n=this.levelRecords[t])&&void 0!==n?n:{levelNumber:t,attempts:[]};i.attempts.push({coins:e.getCoins(),moves:e.getMoves()}),this.levelRecords[t]=i}},{key:"getLastCompletedLevelNumber",value:function(){var t=Object.keys(this.levelRecords).map(Number).sort();return t[t.length-1]||0}}]),t}(),Xt=function(){function t(){s()(this,t),this.name="settings",this.muted=!1}return a()(t,[{key:"toJson",value:function(){return{muted:this.muted}}},{key:"fromJson",value:function(t){var e;this.muted=null!==(e=t.muted)&&void 0!==e&&e}},{key:"getMuted",value:function(){return this.muted}},{key:"setMuted",value:function(t){this.muted=t}}]),t}();function Wt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var Ut=function(t){c()(n,t);var e=Wt(n);function n(){return s()(this,n),e.call(this,{key:U})}return a()(n,[{key:"create",value:function(){this.persistence.addDocument(new Bt),this.persistence.addDocument(new Xt),this.scene.start(W)}}]),n}(Ot),Ft=n(171),Yt=n.n(Ft);function _t(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var Gt=function(t){c()(n,t);var e=_t(n);function n(t,i){var r;return s()(this,n),(r=e.call(this,t,i)).listeners=void 0,r.hasSwiped=void 0,r.listeners=[],r.hasSwiped=!1,t.events.on(Phaser.Scenes.Events.START,r.startListening,Yt()(r)),t.events.on(Phaser.Scenes.Events.SHUTDOWN,r.stopListening,Yt()(r)),r}return a()(n,[{key:"addListener",value:function(t){this.listeners.push(t)}},{key:"removeListener",value:function(t){var e=this.listeners.findIndex((function(e){return e===t}));e>=0&&this.listeners.splice(e,1)}},{key:"startListening",value:function(){this.scene.input.on(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this),this.scene.input.on(Phaser.Input.Events.POINTER_UP,this.onPointerUp,this),this.scene.input.on(Phaser.Input.Events.POINTER_MOVE,this.onPointerMove,this)}},{key:"stopListening",value:function(){this.listeners=[],this.scene.input.off(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this),this.scene.input.off(Phaser.Input.Events.POINTER_UP,this.onPointerUp,this),this.scene.input.off(Phaser.Input.Events.POINTER_MOVE,this.onPointerMove,this)}},{key:"onPointerDown",value:function(){this.hasSwiped=!1}},{key:"onPointerUp",value:function(){this.hasSwiped=!0}},{key:"onPointerMove",value:function(){if(this.scene.input.activePointer.isDown){var t=this.scene.input.activePointer.getDistanceX(),e=this.scene.input.activePointer.getDistanceY(),n=void 0;if(t>75){var r=this.scene.input.activePointer.position.x-this.scene.input.activePointer.prevPosition.x;n=r<0?i.LEFT:i.RIGHT}else if(e>75){var s=this.scene.input.activePointer.position.y-this.scene.input.activePointer.prevPosition.y;n=s<0?i.UP:i.DOWN}n&&!this.hasSwiped&&(this.hasSwiped=!0,this.listeners.slice().forEach((function(t){t(n)})))}}}]),n}(Phaser.Plugins.ScenePlugin);function Vt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var Kt,Jt=function(t){c()(n,t);var e=Vt(n);function n(){var t;return s()(this,n),(t=e.call(this,{key:_})).levelMusic=void 0,t}return a()(n,[{key:"init",value:function(){this.sound.mute=this.persistence.getDocument("settings").getMuted()}},{key:"create",value:function(){this.levelMusic=this.sound.add("level-music",{loop:!0})}},{key:"playLevelMusic",value:function(){this.levelMusic.isPlaying||(this.levelMusic.isPaused?this.levelMusic.resume():this.levelMusic.play())}},{key:"pauseLevelMusic",value:function(){this.levelMusic.pause()}},{key:"playWinSfx",value:function(){var t=this.sound.add("level-complete");return t.play(),new Promise((function(e){t.once(Phaser.Sound.Events.COMPLETE,(function(){t.destroy(),e()}))}))}},{key:"playResetSfx",value:function(){this.sound.play("level-reset")}},{key:"playCoinSfx",value:function(){this.sound.play("coin")}}]),n}(Ot),qt=n(172);!function(t){t[t.NONE=0]="NONE",t[t.BACKGROUND=1]="BACKGROUND",t[t.BACKGROUND_INVERSE=2]="BACKGROUND_INVERSE"}(Kt||(Kt={}));var zt,Qt=function(){function t(e,n,i,r,o,a){var u,c;s()(this,t),this.scene=void 0,this.gameObject=void 0,this.scene=e;var h=this.normalizeContent(o);if(h instanceof Phaser.GameObjects.BitmapText){var l=h.getTextBounds();u=l.global.width,c=l.global.height}else{var f=h.getBounds();u=f.width,c=f.height}var d="";r===Kt.BACKGROUND?d="hud-button":r===Kt.BACKGROUND_INVERSE&&(d="hud-button-inverse"),d?(this.gameObject=new qt.NinePatch(e,n,i,1,1,d,void 0,{top:16,bottom:16,left:16,right:16}),this.gameObject.resize(u+32,c+32)):(this.gameObject=new Phaser.GameObjects.Container(e,n,i),this.gameObject.setSize(u,c)),this.gameObject.add(h),this.gameObject.setInteractive(),this.gameObject.on(Phaser.Input.Events.POINTER_UP,a),e.add.existing(this.gameObject)}return a()(t,[{key:"normalizeContent",value:function(t){return"string"==typeof t?this.scene.add.image(0,0,t):t}}]),t}(),Zt=function(){function t(e,n,i){var r=this;s()(this,t),this.gameObject=void 0,this.scene=void 0,this.settings=void 0,this.volumeIcon=void 0,this.scene=e,this.settings=e.persistence.getDocument("settings"),this.volumeIcon=e.add.image(0,0,"hud-volume"),this.updateVolumeIcon(),this.gameObject=new Qt(e,n,i,Kt.BACKGROUND_INVERSE,this.volumeIcon,(function(){return r.toggleVolume()})).gameObject}return a()(t,[{key:"toggleVolume",value:function(){var t=!this.scene.sound.mute;this.scene.sound.mute=t,this.settings.setMuted(t),this.updateVolumeIcon(),this.scene.persistence.store()}},{key:"updateVolumeIcon",value:function(){this.volumeIcon.setFrame(this.settings.getMuted()?1:0)}}]),t}();!function(t){t[t.EMPTY=0]="EMPTY",t[t.HALF=1]="HALF",t[t.FULL=2]="FULL"}(zt||(zt={}));var $t=function(){function t(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:zt.FULL;s()(this,t),this.gameObject=void 0,this.gameObject=e.add.sprite(n,i,"hud-heart",2).setOrigin(1,.5),this.setValue(r)}return a()(t,[{key:"setValue",value:function(t){this.gameObject.setFrame(this.valueToFrame(t))}},{key:"valueToFrame",value:function(t){switch(t){case zt.EMPTY:return 0;case zt.HALF:return 1;case zt.FULL:return 2;default:return 0}}}]),t}();function te(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var ee=function(t){c()(n,t);var e=te(n);function n(){var t;return s()(this,n),(t=e.call(this,{key:X})).collectedCoinsText=void 0,t.totalCoinsText=void 0,t.hearts=void 0,t}return a()(n,[{key:"create",value:function(t){this.addPauseIcon(),this.addRestartIcon(),this.addCoinsIndicator(t.totalCoins),this.addHearts(t.maxHealth)}},{key:"setTotalCoins",value:function(t){this.totalCoinsText.setText("".concat(t))}},{key:"resetCollectedCoins",value:function(){this.totalCoinsText.setText("".concat(0))}},{key:"setCollectedCoins",value:function(t){this.collectedCoinsText.setText("".concat(t))}},{key:"updateHealth",value:function(t,e){for(var n=this.calculateHearts(t,e),i=n.fullHearts,r=n.halfHearts,s=n.emptyHearts,o=0;o<i;o++)this.hearts[o].setValue(zt.FULL);for(var a=i;a<i+r;a++)this.hearts[a].setValue(zt.HALF);for(var u=i+r;u<i+r+s;u++)this.hearts[u].setValue(zt.EMPTY)}},{key:"addPauseIcon",value:function(){var t=this;new Qt(this,60,this.scale.height-60,Kt.NONE,"hud-pause",(function(){if(!t.scene.isPaused(F)){t.scene.pause(F);var e=t.scale.width/2,n=t.scale.height/2,i=t.add.rectangle(0,0,t.scale.width,t.scale.height,0,.5).setOrigin(0).setAlpha(0),r=t.add.ninePatch(e,-300,250,300,"menubox",null,{top:16,bottom:16,left:16,right:16});r.add([t.add.bitmapText(0,-125,"matchup-32","Paused").setOrigin(.5),t.add.image(113,-138,"hud-close").setInteractive().on(Phaser.Input.Events.POINTER_UP,(function(){t.tweens.add({targets:r,props:{y:-300},duration:400,ease:Phaser.Math.Easing.Cubic.In,onComplete:function(){r.destroy()}}),t.tweens.add({targets:i,props:{alpha:0},duration:400,onComplete:function(){i.destroy()}}),t.scene.resume(F)})),new Qt(t,0,-50,Kt.BACKGROUND,t.add.bitmapText(0,0,"matchup-24","Quit to title").setOrigin(.5),(function(){t.sfx.pauseLevelMusic(),t.cameras.main.once(Phaser.Cameras.Scene2D.Events.FADE_OUT_COMPLETE,(function(){t.scene.stop(),t.scene.stop(F),t.scene.start(Y)})),t.cameras.main.fadeOut(1e3)})).gameObject,new Zt(t,0,100).gameObject]),t.tweens.add({targets:r,props:{y:n},duration:400,ease:Phaser.Math.Easing.Cubic.Out}),t.tweens.add({targets:i,props:{alpha:1},duration:400})}}))}},{key:"addRestartIcon",value:function(){var t=this;new Qt(this,this.scale.width-60,this.scale.height-60,Kt.NONE,"hud-restart",(function(){t.scene.get(F).resetLevel()}))}},{key:"addCoinsIndicator",value:function(t){var e=this.scale.width-60;t>0&&(this.add.image(e-40,60,"coin").setOrigin(.5),this.collectedCoinsText=this.add.bitmapText(e-20,57,"matchup-32","0").setOrigin(0,.5),this.add.bitmapText(e,57,"matchup-32","/").setOrigin(0,.5),this.totalCoinsText=this.add.bitmapText(e+20,57,"matchup-32","".concat(t)).setOrigin(0,.5))}},{key:"addHearts",value:function(t){var e=this,n=this.calculateHearts(t,t),i=n.fullHearts,r=n.halfHearts,s=n.emptyHearts;this.hearts=Array.from({length:i+r+s},(function(t,n){return new $t(e,60+40*n,60)})),this.updateHealth(t,t)}},{key:"calculateHearts",value:function(t,e){var n=Math.floor(t),i=Math.ceil(t-n);return{fullHearts:n,halfHearts:i,emptyHearts:e-i-n}}}]),n}(Ot);function ne(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var ie={fontSize:"16px",color:"#fff",backgroundColor:"#44BF95",stroke:"#000000",strokeThickness:3,padding:{left:10,right:10,top:5,bottom:5}},re={fontSize:"38px",color:"#fff",stroke:"#000000",strokeThickness:3},se=function(t){c()(n,t);var e=ne(n);function n(){var t;return s()(this,n),(t=e.call(this,{key:G})).buttons=void 0,t.buttons=[],t}return a()(n,[{key:"create",value:function(){var t=this;this.input.keyboard.createCombo("debug",{resetOnMatch:!0}),this.input.keyboard.on("keycombomatch",(function(e){e.keyCodes.join()===[68,69,66,85,71].join()&&t.showScene()})),this.add.rectangle(0,0,this.scale.width,this.scale.height,0,.6).setOrigin(0),this.add.text(this.scale.width/2,100,"DEBUG menu",re).setOrigin(.5),this.addButtons(),this.hideScene(),this.scene.bringToTop(),this.scene.launch(U)}},{key:"addButtons",value:function(){var t=this;this.addButton(this.scale.width-30,30,"X",(function(){return t.hideScene()})),this.addButton(this.scale.width/2,150,"clear save data",(function(){localStorage.clear(),location.reload()}))}},{key:"addButton",value:function(t,e,n,i){this.buttons.push(this.add.text(t,e,n,ie).setOrigin(.5).setInteractive({useHandCursor:!0}).on(Phaser.Input.Events.POINTER_DOWN,i))}},{key:"showScene",value:function(){this.scene.setVisible(!0),this.buttons.forEach((function(t){return t.input.enabled=!0}))}},{key:"hideScene",value:function(){this.buttons.forEach((function(t){return t.input.enabled=!1})),this.scene.setVisible(!1)}}]),n}(Phaser.Scene);function oe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}var ae=function(t){c()(n,t);var e=oe(n);function n(){return s()(this,n),e.call(this,{key:V})}return a()(n,[{key:"create",value:function(){var t=this;this.cameras.main.setBackgroundColor("#3d253b");var e=this.add.image(Pt.WIDTH/2,125,"skull");this.tweens.add({targets:e,props:{y:150},yoyo:!0,loop:-1,ease:Phaser.Math.Easing.Quadratic.InOut}),new Qt(this,Pt.WIDTH/2,Pt.HEIGHT/2-50,Kt.BACKGROUND,this.add.bitmapText(0,0,"matchup-24","Restart Level").setOrigin(.5),(function(){return t.fadeToScene(F)})),new Qt(this,Pt.WIDTH/2,Pt.HEIGHT/2+25,Kt.BACKGROUND,this.add.bitmapText(0,0,"matchup-24","Quit to Title").setOrigin(.5),(function(){return t.fadeToScene(Y)}))}},{key:"fadeToScene",value:function(t){var e=this;this.cameras.main.fadeOut(500,0,0,0,(function(n,i){i>.99&&e.scene.start(t)}))}}]),n}(Ot);function ue(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=d()(t);if(e){var r=d()(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l()(this,n)}}p.a.Scene;var ce=[se,Ut,jt,Ht,It,ae,ee,Jt];new p.a.Game({width:Pt.WIDTH,height:Pt.HEIGHT,scene:ce,scale:{mode:p.a.Scale.FIT,autoCenter:p.a.Scale.CENTER_HORIZONTALLY},render:{pixelArt:!0},plugins:{scene:[{key:"Phecs",plugin:g.a,mapping:"phecs"},{key:"Swipe",plugin:Gt,mapping:"swipe"}],global:[{key:"LevelManagerPlugin",plugin:Nt,mapping:"levelManager",start:!0},{key:"PersistencePlugin",plugin:At,mapping:"persistence",start:!0},{key:"NinePatchPlugin",plugin:qt.NinePatchPlugin,start:!0}]}})}});